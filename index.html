<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="EXPIRES" content="Sun, 19 Mar 2023 21:00:00 GMT" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Earshot Events</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="slick/slick.css" />
    <link rel="stylesheet" href="slick/slick-theme.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" type="image/x-icon" href="whoo-icon-01.png" />
  </head>
  <body style="background-color: transparent;">
    <div class="container mt-2 mb-5">
      <div></div>
      <div class="row">
        <div class="col-md-12 root"></div>
		<div class="col-md-12 cardList"></div>
        <div class="text-center" style="margin: auto">
          <img
            src="./css/Reload-1s-200px.gif"
            width="50"
            height="50"
            class="image_id"
            class="text-center"
          />
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script src="slick/slick.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
      integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>

<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <script>

	///////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////

	// For Multiple Start End Support
	////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////
	// ARRAYS
	let outputInit = [];
	let output1 = [];
	let output1_1 = [];
	let output1_2 = [];
	let output2 = [];
	let output2_1 = [];
	let output2_2 = [];
	let output3 = [];
	let inserted;
	//let sorted5 = [];
	////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////
	function doFormat(arr, nDate) {
		//console.log(todayArrayNext, " >>>>>")
		for (var iIndex = 0, iiIndex = arr.length ; iIndex < iiIndex ; iIndex++){
		inserted = false;
		for (var jIndex = 0, jjIndex = outputInit.length ; jIndex < jjIndex ; jIndex++){
			if (new Date(arr[iIndex].start) < new Date(outputInit[jIndex].start) && new Date(outputInit[jIndex].start) < nDate){
				inserted = true;
				outputInit.splice(jIndex, 0, arr[iIndex]);
				break;
			} 
		}
		if (!inserted)
			outputInit.push(arr[iIndex])
		}
		return outputInit
	}
	////////////////////////////////////////////////////////////////////////
	function doFormat1(mFormat, nDate) {
		for (var iIndex = 0, iiIndex = mFormat.length ; iIndex < iiIndex ; iIndex++){
		inserted = false;
		for (var jIndex = 0, jjIndex = output1.length ; jIndex < jjIndex ; jIndex++){
			if (new Date(mFormat[iIndex].start1) < new Date(output1[jIndex].start) && new Date(output1[jIndex].start) < nDate){
				inserted = true;
				output1.splice(jIndex, 0, mFormat[iIndex]);
				break;
			} 
		}
		if (!inserted)
			output1.push(mFormat[iIndex])
		}
		return output1
	}
	////////////////////////////////////////////////////////////////////////
	function doFormat2(mFormat1, nDate) {
		for (var iIndex = 0, iiIndex = mFormat1.length ; iIndex < iiIndex ; iIndex++){
		inserted = false;
		for (var jIndex = 0, jjIndex = output2.length ; jIndex < jjIndex ; jIndex++){
			if (new Date(mFormat1[iIndex].start2) < new Date(output2[jIndex].start1) && new Date(output2[jIndex].start) < nDate){
				inserted = true;
				output2.splice(jIndex, 0, mFormat1[iIndex]);
				break;
			} 
		}
		if (!inserted)
			output2.push(mFormat1[iIndex])
		}
		return output2
	}
	////////////////////////////////////////////////////////////////////////
	function doFormat3(mFormat2, nDate) {
		for (var iIndex = 0, iiIndex = mFormat2.length ; iIndex < iiIndex ; iIndex++){
		inserted = false;
		for (var jIndex = 0, jjIndex = output3.length ; jIndex < jjIndex ; jIndex++){
			if (new Date(mFormat2[iIndex].start2) < new Date(output3[jIndex].start) && new Date(output3[jIndex].start) < nDate){
				inserted = true;
				output3.splice(jIndex, 0, mFormat2[iIndex]);
				break;
			} 
		}
		if (!inserted)
			output3.push(mFormat2[iIndex])
		}
		return output3
	}
	////////////////////////////////////////////////////////////////////////
	function doFormat1_1(mFormat1_1, nDate) {
		for (var iIndex = 0, iiIndex = mFormat1_1.length ; iIndex < iiIndex ; iIndex++){
		inserted = false;
		for (var jIndex = 0, jjIndex = output1_1.length ; jIndex < jjIndex ; jIndex++){
			if (new Date(mFormat1_1[iIndex].start1) < new Date(output1_1[jIndex].start1) && new Date(output1_1[jIndex].start1) < nDate){
				inserted = true;
				output1_1.splice(jIndex, 0, mFormat1_1[iIndex]);
				break;
			} 
		}
		if (!inserted)
			output1_1.push(mFormat1_1[iIndex])
		}
		return output1_1
	}
	////////////////////////////////////////////////////////////////////////
	function doFormat2_1(mFormat2_1, nDate) {
		for (var iIndex = 0, iiIndex = mFormat2_1.length ; iIndex < iiIndex ; iIndex++){
		inserted = false;
		for (var jIndex = 0, jjIndex = output2_1.length ; jIndex < jjIndex ; jIndex++){
			if (new Date(mFormat2_1[iIndex].start) < new Date(output2_1[jIndex].start2) && new Date(output2_1[jIndex].start2) < nDate){
				inserted = true;
				output2_1.splice(jIndex, 0, mFormat2_1[iIndex]);
				break;
			} 
		}
		if (!inserted)
			output2_1.push(mFormat2_1[iIndex])
		}
		return output2_1
	}
	////////////////////////////////////////////////////////////////////////
	function doFormat2_2(mFormat2_2, nDate) {
		for (var iIndex = 0, iiIndex = mFormat2_2.length ; iIndex < iiIndex ; iIndex++){
		inserted = false;
		for (var jIndex = 0, jjIndex = output2_2.length ; jIndex < jjIndex ; jIndex++){
			if (new Date(mFormat2_2[iIndex].start2) < new Date(output2_2[jIndex].start2) && new Date(output2_2[jIndex].start2) < nDate){
				inserted = true;
				output2_2.splice(jIndex, 0, mFormat2_2[iIndex]);
				break;
			} 
		}
		if (!inserted)
			output2_2.push(mFormat2_2[iIndex])
		}
		return output2_2
	}

	///////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////

	// IDLE TIMEOUT
	let idleTime;
	let idleTimeOut = 180 // Idle threshold 3 MINS
	let idleStatus = false
	window.addEventListener('load', resetIdleTimer, true);
	// Event to check for
	let events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
	events.forEach(function (name) {
		document.addEventListener(name, resetIdleTimer, true);
	});

	function idleOut() {
		idleStatus = true
		//console.log("Showing Slide")
		clearTimeout(idleTime);
		idleTime = setTimeout(idleOut, (idleTimeOut * 1000))
	}

	function resetIdleTimer() {
		if(idleStatus == true || idleStatus == undefined) {
			idleStatus = false
			//console.log("Showing Normal View")
		}
		clearTimeout(idleTime);
		idleTime = setTimeout(idleOut, (idleTimeOut * 1000))
	}

	////////////////////////////////////////////////////////////////////////////////////////
	
	function findGetParameter(parameterName) {
		var result = null,
			tmp = [];
		location.search
			.substr(1)
			.split("&")
			.forEach(function (item) {
			tmp = item.split("=");
			if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
			});
		return result;
	}
	/* function findGetDefaultSheet(id) {
		let sheet = ""
		$.ajax({
        url: apiListurl + id + '/sheets/',
        cache: false,
        success: function (response) {
			sheet = response.sheets[0]
		}})
		return sheet
	} */

	function showStatus(props) {
		var capicity =
			props.count && props.capacity
			? `<span class="status">${props.count}/${props.capacity}</span>`
			: "";
		var emoji =
			props.status.toLowerCase() == "looking for players"
			? `<img src="https://media.tenor.com/images/8b5f93c8693a58f564cf9c247db9e39f/tenor.gif" class="flag" alt="Looking for Players">`
			: "";
		if (props.status && props.status.trim().length) {
			return `${emoji} <span class="status">(${props.status.toUpperCase()})</span> ${capicity}`;
		}
		return "";
	}

	function isValidUrl(string) {
		let url;

		try {
			url = new URL(string);
		} catch (_) {
			return null;
		}

		return url.protocol;
	}

	function FilterRecordsBasedOnDate(_val) {
		//console.log(_val + " 0nVal")
		iDate = moment(new Date(_val)).format(DISP_FORMAT)
		/* let updatedResultDate = moment(_val);
		let lookupDate = updatedResultDate.format(DATE_FORMAT)
		let lookupTime = updatedResultDate.format(ONLY_TIME_FORMAT) */

		current = moment(new Date(_val));

		//$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = iDate
		//updatedResultDate = moment($(".root")[0].getElementsByClassName('float-left')[0].innerHTML, DISP_FORMAT);
		//let lookupDate = updatedResultDate.format(DATE_FORMAT)
		//let lookupTime = updatedResultDate.format(ONLY_TIME_FORMAT)

		//console.log(lookupDate, " ---- ", lookupTime)

		//console.log(current)

		//upDateTime();
		//getUpdatedDate(lookupDate, lookupTime)

		////////////////////////////////////////////////////////////////////////////
		// USE IF NEEDED
		upDateTime();
		getSheetValueBasedOnDaySelected(_val)
		////////////////////////////////////////////////////////////////////////////
	}


	function getSheetValueBasedOnDaySelected(_val) {
		//console.log("Called - getSheetValueBasedOnDaySelected")
		/////////////////////////////////////////////////////////////////
		// Close blink Timer
		/////////////////////////////////////////////////////////////////
		// The event time is not UTC, so we will beed to use timeZoneOffset to find the correct time.
		//const locSorting = ["Twitch"];
		let sheetParam = "";
		let randomSliderArray = []
		let room = findGetParameter("loc");
		let iDate = findGetParameter("date");
		let iTime = findGetParameter("time");
		let urlid = findGetParameter("id");
		let sheet = findGetParameter("sheet") == "" || findGetParameter("sheet") == null ? "null" : findGetParameter("sheet")

		/////////////////////
		let TIME_FORMAT = "MM/DD/YYYY HH:mm";
		let DATE_FORMAT = "MM/DD/YYYY";
		let DISP_FORMAT = "MM/DD ddd hh:mm A";
		let ONLY_TIME_FORMAT = "HH:mm";
		let ONLY_MD_FORMAT = "MM/DD HH:mm"


		let utc = new Date();
		let currentUtcStr = "".concat(
		utc.getUTCFullYear(),
		"/",
		utc.getUTCMonth() + 1,
		"/",
		utc.getUTCDate(),
		" ",
		utc.getUTCHours(),
		":",
		utc.getUTCMinutes(),
		":",
		utc.getUTCSeconds()
		);
		let currentUtc = moment(new Date(currentUtcStr));
		//const timeZoneOffset = -4; // EDT
		// const timeZoneOffset = -5; // EST
		let currentAdj = currentUtc.add(timeZoneOffset, "hours");

		let selectedDate = moment(new Date(_val)).format(DATE_FORMAT)
		let currenDate = moment(new Date()).format(DATE_FORMAT)

		//console.log(moment(new Date(_val)).format(TIME_FORMAT))
		/////////////////////////////////////////////////////////////////
		//console.log(selectedDate, " ==== ", currenDate)

		if(selectedDate === currenDate) {
			//console.log("Current Date")
			// The event time is not UTC, so we will beed to use timeZoneOffset to find the correct time.
			//console.log(iDate, " -- ", iTime, " ==== ")
			/* let date =
			iDate == null
				? moment(currentAdj).format(DATE_FORMAT)
				: moment(new Date(iDate)).format(DATE_FORMAT);
			let time =
			iTime == null
				? moment(currentAdj).format("HH:mm")
				: moment(new Date(date + " " + iTime)).format("HH:mm");
			let current = moment(new Date(date));
			if (((!iTime && !iDate) || (iTime && iDate)) && (selectedDate === currenDate)) {
				current = moment(new Date(date + " " + time));
			} */
			/////////////////////////////////////////////////////////////////////////////////////
			// Hide the + - icons if the date is same
			// For Testing REMOVE ONCE DONE
			current = moment(new Date());
			isToday = true
			  /////////////////////////////////////////////////////////////////////////////////////
		} else {
			//console.log("Not Current")
			//console.log(selectedDate, " >>>>")
			//currenDate = moment(new Date(selectedDate))
			current = moment(new Date(selectedDate))
			isToday = false
			//current = moment(new Date(_val))
		}
		//console.log(current, " on click")
		/////////////////////////////////////////////////////////////////

		//console.log(current)

		// Store the current day limit
		nDate = new Date(selectedDate);
		nDate.setDate(nDate.getDate() + 1)
		nDate.setHours(0,0,0,0)
		/////////////////////////////////////////////////////////////////
		////////////////////////////////////////////////////////////////
		if (window.location.href.indexOf("mode=slideshow") != -1) {
		/////////////////////////////////////////////////////////////////
		
		$(".image_slider").remove()
		$(".card.custom_border_left.mt-2").remove()
		$(".text-center").remove()
		$("br").remove();
		$(".image_id").css("display", "none");
		$(".card.custom_border_left.mt-5").remove()

		// Remove Timer
		$(".ak_card_minus").remove()
		$(".ak_card_plus").remove()
		
		document.body.classList.add('slideshow');
        $(".image_id").css("display", "none");


        var todayArray = [];
        var todayArrayNext = [];
		

		sliderData[0].forEach((q) => {
			let data = {
				code: q.Code.toString().replace(/dqo/g, '"'),
				name: q.Event.toString().replace(/dqo/g, '"'),
				speakers: q.Presenters.toString().replace(/dqo/g, '"'),
				desc: q.Description.toString().replace(/dqo/g, '"'),
				start: q.Start,
				end: q.End,
				info: q.Info.toString().replace(/dqo/g, '"'),
				location: Number.isFinite((q.Location)) == false ? q.Location : ("SCHEDULED - " + q.Location),
				capacity: q.Capacity.toString().replace(/dqo/g, '"'),
				count: q.Count,
				images: q.Image.toString().replace(/dqo/g, '"'),
				status: q.Status.toString().replace(/dqo/g, '"'),
				link1: q.Link1.toString().replace(/dqo/g, '"'),
				url1: q.Url1.toString().replace(/dqo/g, '"'),
				link2: q.Link2.toString().replace(/dqo/g, '"'),
				url2: q.Url2.toString().replace(/dqo/g, '"'),
				platform: q.Platform.toString().replace(/dqo/g, '"'),
				accessInfo: q.AccessInfo.toString().replace(/dqo/g, '"'),
				start1: q.Start1,
				end1: q.End1,
				start2: q.Start2,
				end2: q.End2,
				start3: q.Start3,
				end3: q.End3,
				start4: q.Start4,
				end4: q.End4,
			};

            if (data.images.includes("https://drive.google.com")) {
              imgid = data.images.substr(
                data.images.lastIndexOf("id="),
                data.images.length - 1
              );
              data.images = "https://drive.google.com/uc?export=view&" + imgid;
            }

            

			  if (data.location && data.name && (data.start || data.start1 || data.start2 || data.start3 || data.start4) && (data.end || data.end1 || data.end2 || data.end3 || data.end4)) {
				
				//////////////////////////////////////////////////////////////////////////////////
				// For Start 
				let date = new Date(data.start);
				let dateKey = moment(date).format(DATE_FORMAT);
			   
				// For Start1
				let date1 = new Date(data.start1);
				let dateKey1 = moment(date1).format(DATE_FORMAT);
				
				// For Start2
				let date2 = new Date(data.start2);
				let dateKey2 = moment(date2).format(DATE_FORMAT);

				// For Start3
				let date3 = new Date(data.start3);
				let dateKey3 = moment(date3).format(DATE_FORMAT);

				// For Start3
				let date4 = new Date(data.start4);
				let dateKey4 = moment(date4).format(DATE_FORMAT);
				//////////////////////////////////////////////////////////////////////////////////

				// For Start
				if (
				  moment(new Date(data.end)) > current &&
				  dateKey == current.format(DATE_FORMAT)
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start1
				if (
				  moment(new Date(data.end1)) > current &&
				  dateKey1 == current.format(DATE_FORMAT) && moment(new Date(data.start1)) >= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start2
				if (
				  moment(new Date(data.end2)) > current &&
				  dateKey2 == current.format(DATE_FORMAT) && moment(new Date(data.start2)) >= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start3
				if (
				  moment(new Date(data.end3)) > current &&
				  dateKey3 == current.format(DATE_FORMAT) && moment(new Date(data.start3)) <= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start4
				if (
				  moment(new Date(data.end4)) > current &&
				  dateKey4 == current.format(DATE_FORMAT) && moment(new Date(data.start4)) <= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				}
				//////////////////////////////////////////////////////////////////////////////////
              // Store the first events of the day to create a summary calendar link
              if (firstEvents.has(dateKey)) {
                if (date < firstEvents[dateKey]) {
                  firstEvents.set(dateKey, date);
                }
              } else {
                firstEvents.set(dateKey, date);
              }
            }
          });

          if (room != null) {
            var todayArrayNext = todayArray.filter(
              (item) => item.location.toLowerCase().indexOf(room) > -1
            );
          }

          var todayArrayNext = room != null ? todayArrayNext : todayArray;
			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			// Sorting Order
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////
			// New
			// Clear All Containers
			outputInit = [];
			output1 = [];
			output1_1 = [];
			output1_2 = [];
			output2 = [];
			output2_1 = [];
			output2_2 = [];
			output3 = [];
			// Reassing Values to those containers
			let mFormat = doFormat(todayArrayNext, nDate)
			let mFormat1 = doFormat1(mFormat, nDate)
			let mFormat2 = doFormat2(mFormat1, nDate)
			let mFormat1_1 = doFormat3(mFormat2, nDate)
			let mFormat2_1 = doFormat1_1(mFormat1_1, nDate)
			let mFormat2_2 = doFormat2_1(mFormat2_1, nDate)
			let sortedArray = doFormat2_2(mFormat2_2, nDate)

			//let sortedArray = doFormat(sortedArray1, nDate)
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////////////////////////////
          var slideObjArr = [];
          var output = sortedArray.reduce(function (result, value) {
            var location = value.location;
            result[location] = result[location] || [];
            result[location].push({
              code: value.code,
              name: value.name,
              speakers: value.speakers,
              desc: value.desc,
              start: value.start,
              end: value.end,
              info: value.info,
              location: value.location,
              capacity: value.capacity,
              images: value.images,
              count: value.count,
              status: value.status,
              link1: value.link1,
              url1: value.url1,
              link2: value.link2,
              url2: value.url2,
              platform: value.platform,
              accessInfo: value.accessInfo,
			  start1: value.start1,
              end1: value.end1,
            });
            return result;
          }, {});

          if (
            (Object.keys(output).length === 0 &&
              output.constructor === Object) == false
          ) {
            var counter = "";

            let entries = Object.entries(output);

            for (let [index, [key, value]] of entries.entries()) {
              slideObjArr.push(value[0]);

              //console.log("index:"+index  + " Key:"+ key + " value:"+ value)
            }
            // console.log(slideObjArr);
            randomSliderArray = slideObjArr.sort(() => Math.random() - 0.5);
            

            let shownUpnextCount = 0;
            let lastKey = "";

            //$(".root").append(`${showCalLinks()}`);
			function truncateString(str, num) {
			  // If the length of str is less than or equal to num
			  // just return str--don't truncate it.
			  if (str.length <= num) {
				return str
			  }
			  // Return str truncated with '...' concatenated to the end of str.
			  return str.slice(0, num) + '...'
			}

            // add image slider
            $(".root").append(
              `
			  <!--div class="slide_item">
			  	<div class="top_head" onclick="ResetTimerClick()">
					<div class="time" style="margin-left:0px" id=`+0+`>${moment(new Date()).format(DISP_FORMAT)}</div>
				</div-->
                    <div class="mt-2 image_slider" >
						
                      ${randomSliderArray
                        .map(function (galleryValue, index) {

						//////////////////////////////////////
						let isHappeningNowPresent = false;
						let shownHappeningNowCount = 0;
						let visibleCount = 0;


						let isHappeningNow = 0
						if(current < moment(new Date(galleryValue.end))) {
							isHappeningNow =
								current >= moment(new Date(galleryValue.start)) &&
								current < moment(new Date(galleryValue.end));
						} else if(current < moment(new Date(galleryValue.end1))) {
							isHappeningNow =
								current >= moment(new Date(galleryValue.start1)) &&
								current < moment(new Date(galleryValue.end1));
						} else if(current < moment(new Date(galleryValue.end2))) {
							isHappeningNow =
								current >= moment(new Date(galleryValue.start2)) &&
								current < moment(new Date(galleryValue.end2));
						} else if(current < moment(new Date(galleryValue.end3))) {
							isHappeningNow =
								current >= moment(new Date(galleryValue.start3)) &&
								current < moment(new Date(galleryValue.end3));
						} else if(current < moment(new Date(galleryValue.end4))) {
							isHappeningNow =
								current >= moment(new Date(galleryValue.start4)) &&
								current < moment(new Date(galleryValue.end4));
						}

						let isSameDay = 0
						if(current < moment(new Date(galleryValue.end))) {
							isSameDay =
								current.format(DATE_FORMAT) <=
								moment(new Date(galleryValue.start)).format(DATE_FORMAT);
						} else if(current < moment(new Date(galleryValue.end1))) {
							isSameDay =
								current.format(DATE_FORMAT) <=
								moment(new Date(galleryValue.start1)).format(DATE_FORMAT);
						} else if(current < moment(new Date(galleryValue.end2))) {
							isSameDay =
								current.format(DATE_FORMAT) <=
								moment(new Date(galleryValue.start2)).format(DATE_FORMAT);
						} else if(current < moment(new Date(galleryValue.end3))) {
							isSameDay =
								current.format(DATE_FORMAT) <=
								moment(new Date(galleryValue.start3)).format(DATE_FORMAT);
						} else if(current < moment(new Date(galleryValue.end4))) {
							isSameDay =
								current.format(DATE_FORMAT) <=
								moment(new Date(galleryValue.start4)).format(DATE_FORMAT);
						}

						let isUpNext = 0
						if(current < moment(new Date(galleryValue.end))) {
							isUpNext =
								moment(new Date(galleryValue.start)) >= current;
						} else if(current < moment(new Date(galleryValue.end1))) {
							isUpNext =
								moment(new Date(galleryValue.start1)) >= current;
						} else if(current < moment(new Date(galleryValue.end2))) {
							isUpNext =
								moment(new Date(galleryValue.start2)) >= current;
						} else if(current < moment(new Date(galleryValue.end3))) {
							isUpNext =
								moment(new Date(galleryValue.start3)) >= current;
						} else if(current < moment(new Date(galleryValue.end4))) {
							isUpNext =
								moment(new Date(galleryValue.start4)) >= current;
						}

						let isPassed = 0
						if(current < moment(new Date(galleryValue.end))) {
							isPassed =
								moment(new Date(galleryValue.end)) <= current;
						} else if(current < moment(new Date(galleryValue.end1))) {
							isPassed =
								moment(new Date(galleryValue.end1)) <= current;
						} else if(current < moment(new Date(galleryValue.end2))) {
							isPassed =
								moment(new Date(galleryValue.end2)) <= current;
						} else if(current < moment(new Date(galleryValue.end3))) {
							isPassed =
								moment(new Date(galleryValue.end3)) <= current;
						} else if(current < moment(new Date(galleryValue.end4))) {
							isPassed =
								moment(new Date(galleryValue.end4)) <= current;
						}

						let hideEvent = index > shownHappeningNowCount;
						let showEvent =
						isHappeningNow || (isUpNext && !hideEvent);
						if (showEvent) {
						visibleCount++;
						}

						if (lastKey != index) {
						shownUpnextCount = 0;
						shownHappeningNowCount = 0;
						isHappeningNowPresent = false;
						}
						if (!isHappeningNow && isSameDay && isUpNext) {
						shownUpnextCount += 1;
						}
						if (isHappeningNow && shownUpnextCount == 0) {
						isHappeningNowPresent = true;
						shownHappeningNowCount += 1;
						}
						///////////////////////////////////////

                          return `
                          ${
                            galleryValue.images
                              ? `
							  <div class="slide_item">
								<div class="top_head" onclick="ResetTimerClick()">
									<!--div class="card-header ak_card_timer">
										<img id="editTimer" src="images/ear_icon_time.png" width="70px" height="70px" alt="" onclick="timerClick()" />
									</div>
									<div class="card-header ak_card_minus">
										<img id="editTimer" src="images/ear_icon_minus.png" width="70px" height="70px" alt="" onclick="timerMinusClick()" />
									</div>

									<div class="card-header ak_card_plus">
										<img id="editTimer" src="images/ear_icon_plus.png" width="70px" height="70px" alt="" onclick="timerPlusClick()" />
									</div-->
									
									<div class="time" style="margin-left:0px" id=`+index+`>${upDateSlideTime(index)/* moment(new Date()).format(DISP_FORMAT) *//* current.format(DISP_FORMAT) */}</div>
									<!--div class="title">${galleryValue.location}</div-->
									${
										isHappeningNow &&
										shownHappeningNowCount < 2 &&
										isSameDay
											? `<h6 class="card-title ak_card_subtitle mt-3">HAPPENING NOW</h5>`
											: ``
										}
										${
										!isHappeningNow &&
										isHappeningNowPresent &&
										isUpNext &&
										isSameDay &&
										shownUpnextCount == 1
											? `<h6 class="card-title ak_card_subtitle mt-3">UP NEXT</h5>`
											: ``
									}
								</div>

								<div class="expect_ratio_images">
								  <img src="${
									galleryValue.images
								  }" class="ak_img_detail">
								</div>
								<div class="card-index">
								<span class="card-text ak_room_title">${
                                        galleryValue.code
                                      } - ${galleryValue.name}</span>
                                      <span>${showStatus(galleryValue)}</span>

                                      <br>

                                      <b class="speakers" style="color: black !important;">${
                                        galleryValue.speakers
                                      }</b><br>
                                      <div class="ak_room_descp mt-3">

                                        <span class="d-inline-block ${
                                          !galleryValue.images ? ` ` : `nay_des`
                                        }">${truncateString(galleryValue.desc, 180)}</span>
                                      </div>

									</div>
									<div class="ftr-info-text">
									<div class="leftInfo">
									  <div class="info float-left  w-100">${
										/* moment(galleryValue.start, DISP_FORMAT).format(DISP_FORMAT) */
										galleryValue.info
									  }</div>
									  <span class="float-left w-100 ak_date">${moment(
										new Date(galleryValue.start)
									  ).format("dddd hh:mm A")} - ${moment(
										  new Date(galleryValue.end)
										).format("hh:mm A")}</span>
										<span class="info float-left  w-100">${galleryValue.location}</span>
										</div>
										<div class="barcode">
											<div id="qrcode${`_${index}`}"></div>
										</div>
									</div>
									
							</div>
                            `
                              : `

                            `
                          }
                          `;
                        })
                        .join("")}
                  </div>
                    `
            );

			// Creating QR Code
			randomSliderArray.map(function (galleryValue, index) {
				let regexp = /android|iphone|kindle|ipad/i;
      		   let isMobileDevice = regexp.test(navigator.userAgent);
				// to check screen landscape or potrait
				var mql = window.matchMedia("(orientation: portrait)");

				// If there are matches, we're in portrait
				if(mql.matches && !isMobileDevice) {
					// Portrait orientation
					var width = height = 150;
				} else {
					// Landscape orientation
					var width = height = 100;
				}
				//console.log(width, " width ", document.getElementById('qrcode_' + index))
				if(document.getElementById('qrcode_' + index) != null) {
					const qrcode = new QRCode(document.getElementById('qrcode_' + index), {
					text: String(galleryValue.url1),
					width: width,
					height: height,
					colorDark : '#000',
					colorLight : '#fff',
					correctLevel : QRCode.CorrectLevel.H
					});
				}
			})

            $(".image_slider").slick({
              dots: false,
              arrows: true,
              infinite: true,
              speed:400,
			  autoplaySpeed: 10000,
              autoplay: true,
              slidesToShow: 1,
			  adaptiveHeight:true,
              slidesToScroll: 1
            });

			function upDateSlideTime(_index) {
				let mTimerTimeout = setTimeout(updateTimerTimer, 10)
				function updateTimerTimer() {
					clearTimeout(mTimerTimeout)
					document.getElementById(_index).innerHTML = moment(new Date()).format(DISP_FORMAT)
					mTimerTimeout = setTimeout(updateTimerTimer, (1000))
				}
			}

            for (let [index, [key, value]] of entries.entries()) {
              color = colors[index % colors.length];
              let button1 = value[0].url1
                ? `
                    <a href=${`${value[0].url1}`} target="_blank">
                      <button type="button" class="btn btn-outline-dark float-right">${
                        value[0].link1
                      }</button>
                    </a>`
                : "";

              let button2 = value[0].url2
                ? `
                    <a href=${`${value[0].url2}`} target="_blank">
                      <button type="button" class="btn btn-outline-dark float-right">${
                        value[0].link2
                      }</button>
                    </a>`
                : "";

              let platform = value[0].platform
                ? `
                      <div class="tabletop-sim float-right">${value[0].platform} | ${value[0].accessInfo}</div>
                    `
                : "";

              let isHappeningNowPresent = false;
              let shownHappeningNowCount = 0;
              let visibleCount = 0;

            }
        } else {
            //$(".root").append(`${showCalLinks()}`);
            $(".root").append(
              ` <br><br><br>
                  <h1 class="text-center">NO EVENTS TODAY</h1>
      <div class="text-center">But you can find events for the following dates:</div>
      <div class="text-center">${showDateLinks()}</div>
                `
            );
          }

          $(".active").click(function () {
            var word = $(this).attr("class");

            var lastword = word.replace("active", "");

            var str = lastword.replace(/\s/g, "");

            if ($.trim($("." + str).text()) === "MORE") {
              $("." + str).text("LESS");
            } else {
              $("." + str).text("MORE");
            }

            $(`.hidden_card_${str}`).slideToggle();
          });
        
		/////////////////////////////////////////
		///////////////////////////////////////
		////////////////////////////////////


		} else { // Slideshow Ends
			// Normal mode
			//console.log("Normal mode")

			$(".image_slider").remove()
			$(".card.custom_border_left.mt-2").remove()
			$(".text-center").remove()
			$("br").remove();
			$(".image_id").css("display", "none");
			$(".card.custom_border_left.mt-5").remove()

			// Remove Timer
			$(".ak_card_minus").remove()
			$(".ak_card_plus").remove()
			
			//return

			var todayArray = [];
			var todayArrayNext = [];
			randomSliderArray = [];

			let mTodayArray = [];

			//let currentTime = current.format(DISP_FORMAT)
			//let resultDate = moment(currentTime, DISP_FORMAT);


			//console.log(sliderData[0], " >>>> ")

			//console.log(Number.isFinite((sliderData[0].Location)))


			sliderData[0].forEach((q) => {
			let data = {
				code: q.Code.toString().replace(/dqo/g, '"'),
				name: q.Event.toString().replace(/dqo/g, '"'),
				speakers: q.Presenters.toString().replace(/dqo/g, '"'),
				desc: q.Description.toString().replace(/dqo/g, '"'),
				start: q.Start,
				end: q.End,
				info: q.Info.toString().replace(/dqo/g, '"'),
				location: Number.isFinite((q.Location)) == false ? q.Location : ("SCHEDULED - " + q.Location),
				capacity: q.Capacity.toString().replace(/dqo/g, '"'),
				count: q.Count,
				images: q.Image.toString().replace(/dqo/g, '"'),
				status: q.Status.toString().replace(/dqo/g, '"'),
				link1: q.Link1.toString().replace(/dqo/g, '"'),
				url1: q.Url1.toString().replace(/dqo/g, '"'),
				link2: q.Link2.toString().replace(/dqo/g, '"'),
				url2: q.Url2.toString().replace(/dqo/g, '"'),
				platform: q.Platform.toString().replace(/dqo/g, '"'),
				accessInfo: q.AccessInfo.toString().replace(/dqo/g, '"'),
				start1: q.Start1,
				end1: q.End1,
				start2: q.Start2,
				end2: q.End2,
				start3: q.Start3,
				end3: q.End3,
				start4: q.Start4,
				end4: q.End4,
			};
			if (data.images.includes("https://drive.google.com")) {
				imgid = data.images.substr(
				data.images.lastIndexOf("id="),
				data.images.length - 1
				);
				data.images = "https://drive.google.com/uc?export=view&" + imgid;
			}
			// Filter the date based on current day
			if (data.location && data.name && (data.start || data.start1 || data.start2 || data.start3 || data.start4) && (data.end || data.end1 || data.end2 || data.end3 || data.end4)) {

				/////////////////////////////////////////////////////////////////////////////////////

				//console.log(data.start2, " >> START 2")

				// For Start
				let date = new Date(data.start);
				let dateKey = moment(date).format(DATE_FORMAT);

				// For Start1
				let date1 = new Date(data.start1);
				let dateKey1 = moment(date1).format(DATE_FORMAT);

				// For Start2
				let date2 = new Date(data.start2);
				let dateKey2 = moment(date2).format(DATE_FORMAT);

				// For Start3
				let date3 = new Date(data.start3);
				let dateKey3 = moment(date3).format(DATE_FORMAT);

				// For Start1
				let date4 = new Date(data.start4);
				let dateKey4 = moment(date4).format(DATE_FORMAT);

				//console.log(dateKey2, " >>>>> ", current.format(DATE_FORMAT), " ----- ", (moment(new Date(data.start2)).format(DATE_FORMAT) == current.format(DISP_FORMAT)))

				//console.log(moment(new Date(data.end2)) , " > ", current)
				//console.log(dateKey2, " === ", current.format(DATE_FORMAT) , " && ", moment(new Date(data.start2)) , " <= ", current)

				// For Start
				if (
				moment(new Date(data.end)) > current &&
				dateKey == current.format(DATE_FORMAT)
				) {
				// This event is for the given day, and is either happening now, or later in the day
				//console.log("ENTER 0")
				todayArray.push(data);
				} else

				// For Start1
				if (
				moment(new Date(data.end1)) > current &&
				dateKey1 == current.format(DATE_FORMAT) && moment(new Date(data.start1)) <= current
				) {
				// This event is for the given day, and is either happening now, or later in the day
				//console.log("ENTER 1")
				todayArray.push(data);
				} else

				// For Start2
				if (
				moment(new Date(data.end2)) > current &&
				dateKey2 == current.format(DATE_FORMAT) && (moment(new Date(data.start2)) <= current)
				) {
				// This event is for the given day, and is either happening now, or later in the day
				//console.log("ENTER 2")
				todayArray.push(data);
				} else

				// For Start3
				if (
				moment(new Date(data.end3)) > current &&
				dateKey3 == current.format(DATE_FORMAT) && moment(new Date(data.start3)) <= current
				) {
				// This event is for the given day, and is either happening now, or later in the day
				todayArray.push(data);
				} else 

				// For Start4
				if (
				moment(new Date(data.end4)) > current &&
				dateKey4 == current.format(DATE_FORMAT) && moment(new Date(data.start4)) <= current
				) {
				// This event is for the given day, and is either happening now, or later in the day
				todayArray.push(data);
				}
				////////////////////////////////////////////////////////////////////////////////////////////

				// Store the first events of the day to create a summary calendar link
				// For Start
				if (firstEvents.has(dateKey)) {
				if (date < firstEvents[dateKey]) {
					firstEvents.set(dateKey, date);
				}
				} else {
					firstEvents.set(dateKey, date);
				}
			}
			});

			if (room != null) {
			var todayArrayNext = todayArray.filter(
				(item) => item.location.toLowerCase().indexOf(room) > -1
			);
			}

			var todayArrayNext = room != null ? todayArrayNext : todayArray;
			// var sortedArray  = todayArrayNext.sort((a,b) => new Date(a.start) - new Date(b.start));


			


			//console.log(todayArrayNext, " >>> todayArray")

			/* function sortDates(arr) { 
				return [...arr].sort((a, b) => {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					//if (aLoc == -1 && bLoc == -1) {
						//console.log(b.start1, " >>>")
						if(b.start1 != "") {
							return new Date(a.start) - new Date(b.start1) 
						} else {
							return new Date(a.start) - new Date(b.start) 
						}
					//}
				})
			} */

			//sortedArray = sortDates(todayArrayNext)
			//todayArray = sortDates(todayArray)
			//console.log(todayArrayNext, " AFTER SORT")


			/* var sortedArray = todayArrayNext.sort(function (a, b) {
				const aLoc = locSorting.indexOf(a.location);
				const bLoc = locSorting.indexOf(b.location);
				////////////////////////////////////////////////////////
				if (aLoc == -1 && bLoc == -1) {
					//return new Date(a.start) - new Date(b.start);
					//if(a.start1 != undefined && b.start1 != undefined) {
						//return new Date(a.start1) - new Date(b.start1) 
					//} else {
					//return new Date(a.start) - new Date(b.start)
					//}
					//console.log(b.start2, " >>>> ")
					if(b.start2 != " ") {
						return new Date(a.start) - new Date(b.start1) - new Date(b.start2) 
					} else if(b.start1 != " ") {
						return new Date(a.start) - new Date(b.start1) 
					} else {
						return new Date(a.start) - new Date(b.start) 
					}
					
				}
				if (aLoc == -1) {
					return 1;
				}
				if (bLoc == -1) {
					return -1;
				}
				//return new Date(a.start) - new Date(b.start)
				if(b.start2 != " " || b.start2 != "") {
					return new Date(a.start) - new Date(b.start1) - new Date(b.start2) 
				} else if(b.start1 != " " || b.start1 != "") {
					return new Date(a.start) - new Date(b.start1) 
				} else {
					return new Date(a.start) - new Date(b.start) 
				}
			}); */

			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			function getSortedArr(todayArrayNext) {
				return [...todayArrayNext].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					//if (aLoc == -1 && bLoc == -1) {
						return new Date(a.start) - new Date(b.start)
					//}
					/* if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					} */
					
					return new Date(a.start) - new Date(b.start)
				})
			}
			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			// Sort Based on Start 1
			function getSortedArrStart1(sortStart) {
				return [...sortStart].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					if (aLoc == -1 && bLoc == -1) {
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start1 != "" && new Date(b.start1) >= new Date(selectedDate) && new Date(b.start1) < nDate) {
								//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start1)
							} 
						}
					}
					if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					}
					/* if(b.start2 != "" && new Date(b.start2) >= new Date(selectedDate)) {
						return new Date(a.start) - new Date(b.start2)
					} */ 
					if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
						return new Date(b.start) - new Date(a.start)
					} else {
						if(b.start1 != "" && new Date(b.start1) >= new Date(selectedDate) && new Date(b.start1) < nDate) {
							//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
							return new Date(a.start) - new Date(b.start1)
						} 
					}
				})
			}

			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			// Sort Based on Start 2
			function getSortedArrStart2(sortStart2) {
				return [...sortStart2].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					//if (aLoc == -1 && bLoc == -1) {
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start2 != "" && new Date(b.start2) >= new Date(selectedDate) && new Date(b.start2) < nDate) {
								//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start2)
							}
						}
					//}
					/* if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					} */
					/* if(b.start1 != '' && new Date(b.start1) >= new Date(selectedDate)) {
						return new Date(a.start) - new Date(b.start1)
					} */
					if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
						return new Date(b.start) - new Date(a.start)
					} else {
						if(b.start2 != "" && new Date(b.start2) >= new Date(selectedDate) && new Date(b.Start2) < nDate) {
							//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
							return new Date(a.start) - new Date(b.start2)
						}
					}
				})
			}

			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			// Sorting Order
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////
			// Previous
			/* let sortStart = getSortedArr(todayArrayNext)
			let sortStart2 = getSortedArrStart1(sortStart)
			let sortedArray = getSortedArrStart2(sortStart2) */
			// New
			// Clear All Containers
			outputInit = []
			output1 = []
			output1_1 = []
			output1_2 = []
			output2 = []
			output2_1 = []
			output2_2 = []
			output3 = []
			// Reassing Values to those containers
			let mFormat = doFormat(todayArrayNext, nDate)
			let mFormat1 = doFormat1(mFormat, nDate)
			let mFormat2 = doFormat2(mFormat1, nDate)
			let mFormat1_1 = doFormat3(mFormat2, nDate)
			let mFormat2_1 = doFormat1_1(mFormat1_1, nDate)
			let mFormat2_2 = doFormat2_1(mFormat2_1, nDate)
			let sortedArray = doFormat2_2(mFormat2_2, nDate)
			
			//let sortedArray = doFormat(sortedArray1, nDate)
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			//var sortedArray = getSortedArr()
			var slideObjArr = [];
			//console.log(sortStart, "todayArrayNext")
			//console.log(sortStart2, " sortedArray 2")
			//console.log(sortedArray, " sortedArray")
			////////////////////////////////////////////////////////////////////////////////////////////////////////////

			var output = sortedArray.reduce(function (result, value) {
			var location = value.location;
			result[location] = result[location] || [];
			result[location].push({
				code: value.code,
				name: value.name,
				speakers: value.speakers,
				desc: value.desc,
				start: value.start,
				end: value.end,
				info: value.info,
				location: value.location,
				capacity: value.capacity,
				images: value.images,
				count: value.count,
				status: value.status,
				link1: value.link1,
				url1: value.url1,
				link2: value.link2,
				url2: value.url2,
				platform: value.platform,
				accessInfo: value.accessInfo,
				start1: value.start1,
				end1: value.end1,
				start2: value.start2,
				end2: value.end2,
				start3: value.start3,
				end3: value.end3,
				start4: value.start4,
				end4: value.end4,
			});
			return result;
			}, {});

			if (
			(Object.keys(output).length === 0 &&
				output.constructor === Object) == false
			) {
			var counter = "";

			/* function sortDates(arr) { 
				return [...arr].sort((a, b) => {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					//if (aLoc == -1 && bLoc == -1) {
						//console.log(b.start1, " >>>")
						if(b.start1 != " " || b.start1 != "") {
							return new Date(a.start) - new Date(b.start1) 
						} else {
							return new Date(a.start) - new Date(b.start) 
						}
					//}
				})
			} */

			
			let entries = Object.entries(output);

			/* function sortObjectEntries(obj){
				return Object.entries(obj).sort((a,b) => {
					console.log(b.start1, " >>>")
					if(b.start1 != " " || b.start1 != "") {
						return new Date(a.start) - new Date(b.start1) 
					} else {
						return new Date(a.start) - new Date(b.start) 
					}
				})
			} */

			//console.log(Object.keys(output))
		
			//console.log(sortDates(output), " enterus")

			for (let [index, [key, value]] of entries.entries()) {
				slideObjArr.push(value[0]);
				//console.log("index:"+index  + " Key:"+ key + " value:"+ value)
			}
			

			//let randomSliderArray = sortDates(slideObjArr)
			//console.log(slideObjArr[slideObjArr.length-1].end);
			////////////////////////////////////////////////////////////////////
			// Storing todays event start and end of last event time
			////////////////////////////////////////////////////////////////////////
			//console.log(todayArray)
			/* let myArr = []
			let leftArray = []
			let index = 0
			for (var i=0; i<todayArray.length; i++) {
				console.log((moment(new Date(todayArray[i].start))).format(DISP_FORMAT), " ----- ", currenDate)
				if((moment(new Date(todayArray[i].start))).format(DISP_FORMAT) >= currenDate || (moment(new Date(todayArray[i].start1).format(DISP_FORMAT) >= currenDate) && todayArray[i].start1 == undefined)) {
					myArr[index] = (todayArray[i])
					index++
				} 
			}
			for (var ii=0; ii<todayArray.length; ii++) {
				if((moment(new Date(todayArray[ii].start))).format(DISP_FORMAT) >= currenDate || (moment(new Date(todayArray[ii].start1).format(DISP_FORMAT) >= currenDate) && todayArray[ii].start1 != undefined)) {
					myArr[index] = (todayArray[i])
					index++
				} 
			}
			console.log(myArr, " QRR") */
			/////////////////////////////////////////////////////////////////////////////////////////////
			//todayArray = sortDates(todayArray)
			//console.log(todayArray, " todayArray")
			//console.log(todayArrayNext, " init array")
			//console.log(sortedArray, " init array")
			/////////////////////////////////////////////////////////////////////////////////////////////
			sortedArray.sort()

			//console.log(current, " >>>>> ")


			if(sortedArray[sortedArray.length-1].end1 != "" && sortedArray[sortedArray.length-1].end2 != "") {
				//console.log("1")
				//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End2)
				_initEventTime = sortedArray[0].start
				_lastEventTime = sortedArray[sortedArray.length-1].end2
			} else if(sortedArray[sortedArray.length-1].end1 == "" && sortedArray[sortedArray.length-1].end2 != "") {
				//console.log("2")
				//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End2)
				_initEventTime = sortedArray[0].start
				_lastEventTime = sorted1[sorted1.length-1].end2
			} else if(sortedArray[sortedArray.length-1].end1 != "" && sortedArray[sortedArray.length-1].end2 == "") {
				//console.log("3")
				//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End1) 
				_initEventTime = sortedArray[0].start
				_lastEventTime = sortedArray[sortedArray.length-1].end1
			} else {
				//console.log("4")
				//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End) 
				_initEventTime = sortedArray[0].start
				_lastEventTime = sortedArray[sortedArray.length-1].end
			}

			//console.log(_initEventTime, " ---- ", _lastEventTime)
			/////////////////////////////////////////////////////////////////////////////////////////////
			/* todayArray.sort(todayArray.start)
			_initEventTime = todayArray[0].start
			_lastEventTime = todayArray[todayArray.length-1].end */
			////////////////////////////////////////////////////////////////////


			//console.log(_initEventTime, " IIII ", _lastEventTime)
			//console.log(todayArray[0].start1, " start1")
			
			let randomSliderArray = slideObjArr.sort(() => Math.random() - 0.5);
			//let randomSliderArray = slideObjArr;

			
			//console.log(randomSliderArray, " OBJ SORT")
			//console.log(slideObjArr)

			let shownUpnextCount = 0;
			let lastKey = "";

			
			$(".root").append(`${showCalLinks(todayArray.length)}`);

			//timerClick()

			// add image slider
			$(".root").append(
				`
					<div class="mt-2 image_slider" >
						${randomSliderArray
						.map(function (galleryValue, index) {
							return `
							${
							galleryValue.images
								? `
							<a class="px-2" href="#${galleryValue.location
								.toLowerCase()
								.replace(/\s/g, "")}">
							<div class="expect_ratio_images">
								<img src="${
								galleryValue.images
								}" class="ak_img_detail">
							</div>
							<div class="ak_img_desc">${galleryValue.name}
							</div>
							</a>
							`
								: `

							`
							}
							`;
						})
						.join("")}
					</div>
					`
			);

			$(".image_slider").slick({
				dots: false,
				arrows: true,
				infinite: true,
				speed: 300,
				autoplay: true,
				slidesToShow: 7,
				slidesToScroll: 2,
				responsive: [
				{
					breakpoint: 1199,
					settings: {
					slidesToShow: 6,
					slidesToScroll: 6,
					infinite: true,
					dots: true,
					},
				},
				{
					breakpoint: 999,
					settings: {
					slidesToShow: 5,
					slidesToScroll: 5,
					infinite: true,
					dots: true,
					},
				},
				{
					breakpoint: 768,
					settings: {
					slidesToShow: 3,
					slidesToScroll: 3,
					},
				},
				{
					breakpoint: 568,
					settings: {
					slidesToShow: 1,
					slidesToScroll: 1,
					},
				},
				]
			});

			//console.log("ENTEREU ", entries)
			//console.log(entries.entries(), randomSliderArray.length)
			for (let [index, [key, value]] of entries.entries()) {
				color = colors[index % colors.length];

				//slideObjArr.push(value[0]);
				//console.log("index:"+index  + " Key:"+ key + " value:"+ value)
				// console.log(
				//  "1_index:" + index + " Key:" + key + " value:" + value[0].url1
				// );
				//              var path = (value[0].url1)

				/* if (value[0].url1.length > 0) {
				if (
					value[0].url1.indexOf("http://") === -1 ||
					value[0].url1.indexOf("https://") === -1
				) {
					value[0].url1 = "http://" + value[0].url1;
				}
				}
				*/

				//if (urlString.indexOf('http://') === 0 || urlString.indexOf('https://') === 0)

				// console.log("akhm"+(path.isAbsolute));


				let button1 = value[0].url1
				? `
					<a href=${`${value[0].url1}`} target="_blank">
						<button type="button" class="btn btn-outline-light float-right mt-310">${
						value[0].link1
						}</button>
					</a>`
				: "";

				let button2 = value[0].url2
				? `
					<a href=${`${value[0].url2}`} target="_blank">
						<button type="button" class="btn btn-outline-light float-right mt-310">${
						value[0].link2
						}</button>
					</a>`
				: "";

				let platform = value[0].platform
				? `
						<div class="tabletop-sim float-right">${value[0].platform} | ${value[0].accessInfo}</div>
					`
				: "";

				let isHappeningNowPresent = false;
				let shownHappeningNowCount = 0;
				let visibleCount = 0;

				$(".root").append(
				`
						<div class="card custom_border_left mt-2" style="border-left-color:#${color}">
							<div class="card-header ak_card_header" style="background:#${color}">

							<h4 class="card-room d-inline" id="${key
								.toLowerCase()
								.replace(/\s/g, "")}">${key}</h4>

							${button2}
							${button1}

							</div>

							${value
							.map(function (que, index) {

								//console.log("AAAAAA - ", current)

								/* let isHappeningNow =
								current >= moment(new Date(que.start)) &&
								current < moment(new Date(que.end)); */
								let isHappeningNow = 0
								if(current < moment(new Date(que.end))) {
									isHappeningNow = current >= moment(new Date(que.start)) &&
										current < moment(new Date(que.end));
								} else if(current < moment(new Date(que.end1))) {
									isHappeningNow = current >= moment(new Date(que.start1)) &&
										current < moment(new Date(que.end1));
								} else if(current < moment(new Date(que.end2))) {
									isHappeningNow = current >= moment(new Date(que.start2)) &&
										current < moment(new Date(que.end2));
								} else if(current < moment(new Date(que.end3))) {
									isHappeningNow = current >= moment(new Date(que.start3)) &&
										current < moment(new Date(que.end3));
								} else if(current < moment(new Date(que.end4))) {
									isHappeningNow = current >= moment(new Date(que.start4)) &&
										current < moment(new Date(que.end4));
								}


								/* let isSameDay =
								current.format(DATE_FORMAT) ==
								moment(new Date(que.start)).format(DATE_FORMAT); */
								let isSameDay = 0
								if(current < moment(new Date(que.end))) {
									isSameDay =
										current.format(DATE_FORMAT) <=
										moment(new Date(que.start)).format(DATE_FORMAT);
								} else if(current < moment(new Date(que.end1))) {
									isSameDay =
										current.format(DATE_FORMAT) <=
										moment(new Date(que.start1)).format(DATE_FORMAT);
								} else if(current < moment(new Date(que.end2))) {
									isSameDay =
										current.format(DATE_FORMAT) <=
										moment(new Date(que.start2)).format(DATE_FORMAT);
								} else if(current < moment(new Date(que.end3))) {
									isSameDay =
										current.format(DATE_FORMAT) <=
										moment(new Date(que.start3)).format(DATE_FORMAT);
								} else if(current < moment(new Date(que.end4))) {
									isSameDay =
										current.format(DATE_FORMAT) <=
										moment(new Date(que.start4)).format(DATE_FORMAT);
								}


								/* let isUpNext =
								moment(new Date(que.start)) >= current; */
								let isUpNext = 0
								if(current < moment(new Date(que.end))) {
									isUpNext =
										moment(new Date(que.start)) >= current;
								} else if(current < moment(new Date(que.end1))) {
									isUpNext =
										moment(new Date(que.start1)) >= current;
								} else if(current < moment(new Date(que.end2))) {
									isUpNext =
										moment(new Date(que.start2)) >= current;
								} else if(current < moment(new Date(que.end3))) {
									isUpNext =
										moment(new Date(que.start3)) >= current;
								} else if(current < moment(new Date(que.end4))) {
									isUpNext =
										moment(new Date(que.start4)) >= current;
								}

								/* let isPassed =
								moment(new Date(que.end)) <= current; */
								
								let isPassed = 0
								if(current < moment(new Date(que.end))) {
									isPassed =
										moment(new Date(que.end)) <= current;
								} else if(current < moment(new Date(que.end1))) {
									isPassed =
										moment(new Date(que.end1)) <= current;
								} else if(current < moment(new Date(que.end2))) {
									isPassed =
										moment(new Date(que.end2)) <= current;
								} else if(current < moment(new Date(que.end3))) {
									isPassed =
										moment(new Date(que.end3)) <= current;
								} else if(current < moment(new Date(que.end4))) {
									isPassed =
										moment(new Date(que.end4)) <= current;
								}

								let hideEvent = index > shownHappeningNowCount;
								
								let showEvent =
								isHappeningNow || (isUpNext && !hideEvent);

								if (showEvent) {
									visibleCount++;
								}

								if (lastKey != key) {
									shownUpnextCount = 0;
									shownHappeningNowCount = 0;
									isHappeningNowPresent = false;
								}
								if (!isHappeningNow && isSameDay && isUpNext) {
									shownUpnextCount += 1;
								}
								if (isHappeningNow && shownUpnextCount == 0) {
									isHappeningNowPresent = true;
									shownHappeningNowCount += 1;
								}

								//console.log(key, " AAAAA -", isPassed, " - ", isSameDay, " -- ", isHappeningNow, " --- ", hideEvent)
								/* console.log(current , "<1", moment(new Date(que.end)), " === ", nDate)
								console.log(current , "<2", moment(new Date(que.end1)), " === ", nDate)
								console.log(current , "<3", moment(new Date(que.end2)), " === ", nDate) */


								let dispDate = ""
								if(current < moment(new Date(que.end)) && new Date(que.end) < nDate) {
									//console.log(key, " show start/end")
									dispDate = moment(new Date(que.start)).format("dddd hh:mm A") + " - " + moment(new Date(que.end)).format("hh:mm A")
								} else if(current < moment(new Date(que.end1)) && new Date(que.end1) < nDate) {
									//console.log(key, " show start1/end1")
									dispDate = moment(new Date(que.start1)).format("dddd hh:mm A") + " - " + moment(new Date(que.end1)).format("hh:mm A")
								} else if(current < moment(new Date(que.end2)) && new Date(que.end2) < nDate) {
									//console.log(key, " show start2/end2")
									dispDate = moment(new Date(que.start2)).format("dddd hh:mm A") + " - " + moment(new Date(que.end2)).format("hh:mm A")
								}

								lastKey = key;
								// console.log(que.name, {isHappeningNow: isHappeningNow, isSameDay: isSameDay, isUpNext: isUpNext, isPassed: isPassed, visibleCount: visibleCount, shownUpnextCount: shownUpnextCount, hideEvent: hideEvent, showEvent: showEvent, shownHappeningNowCount: shownHappeningNowCount, length: value.length, index: index, hasMore: hasMore});

								return `

									${
									shownUpnextCount == 0 &&
									isSameDay &&
									isUpNext &&
									!isHappeningNow
										? `<h5 class="card-title ak_card_subtitle mt-3 ml-3">NO CURRENT EVENT ${index}</h5>`
										: ``
									}

									${
									!isPassed && isSameDay
										? `${`
										<div class="${
										isHappeningNow && isSameDay
											? "card-body"
											: "card-footer ak_card_footer"
										} ${
											hideEvent
											? `hidden_card_${key.replace(
												/\s/g,
												""
												)}`
											: ""
										}"
										style="${
										showEvent
											? "display:block"
											: "display:none"
										}"
										id="
										${que.name
										.toLowerCase()
										.replace(/\s/g, "")}
										"
										>

										${
										isHappeningNow &&
										shownHappeningNowCount < 2 &&
										isSameDay
											? `<h5 class="card-title ak_card_subtitle mt-3">HAPPENING NOW</h5>`
											: ``
										}
										${
										!isHappeningNow &&
										isHappeningNowPresent &&
										isUpNext &&
										isSameDay &&
										shownUpnextCount == 1
											? `<h5 class="card-title ak_card_subtitle mt-3">UP NEXT</h5>`
											: ``
										}
										<!-- MULTIPLE ///////////////////////////////////////////////////////////////// -->

										
										<span class="card-text ak_room_title">${
										que.code
										} - ${que.name}</span>
										<span>${showStatus(que)}</span>
										<span class="float-right ak_date">${dispDate/* (current < moment(new Date(que.end))) ? moment(
										new Date(que.start)
										).format("dddd hh:mm A") : (current < moment(new Date(que.end1))) ? moment(
										new Date(que.start1)
										).format("dddd hh:mm A") : (current < moment(new Date(que.end2))) ? moment(
										new Date(que.start2)
										).format("dddd hh:mm A") : (current < moment(new Date(que.end3))) ? moment(
										new Date(que.start3)
										).format("dddd hh:mm A") : (current < moment(new Date(que.end4))) ? moment(
										new Date(que.start4)
										).format("dddd hh:mm A") : ''} - ${(current < moment(new Date(que.end))) ? moment(
											new Date(que.end)
										).format("hh:mm A") : (current < moment(new Date(que.end1))) ? moment(
											new Date(que.end1)
										).format("hh:mm A") : (current < moment(new Date(que.end2))) ? moment(
											new Date(que.end2)
										).format("hh:mm A") : (current < moment(new Date(que.end3))) ? moment(
											new Date(que.end3)
										).format("hh:mm A") : (current < moment(new Date(que.end4))) ? moment(
											new Date(que.end4)
										).format("hh:mm A") : '' */}</span>
										<br>
										<!-- /////////////////////////////////////////////////////////////////////////// -->
										
										<b style="color: black !important;">${
										que.speakers
										}</b><br>
										<div class="ak_room_descp mt-3">
										${
											!que.images
											? `

											`
											: `
											<img class="ak_desc_img" data-toggle="modal" data-target="#${que.name
											.toLowerCase()
											.replace(/\s/g, "")}" src=${
												que.images
												} />
										<div class="modal fade" id="${que.name
											.toLowerCase()
											.replace(
											/\s/g,
											""
											)}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
										<div class="modal-dialog modal-xl" role="document">
											<button type="button" class="close close-modal p-4" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
											</button>
											<img src=${
											que.images
											} class="img-fluid modal-image" />
											<span class="px-4 py-2 d-block">${
											que.name
											}</span>
										</div>
										</div>
											`
										}

										<span class="d-inline-block ${
											!que.images ? ` ` : `nay_des`
										}">${que.desc}</span>
										</div>


										<div class="info float-left">${
										que.info
										}</div>
										${platform}
										</div>

										`}`
										: ``
									}
									`;
							})
							.join("")}
						${
							value.length > visibleCount
							? `<h6 class="text-center more pb-3">
							<span class="active ${key.replace(
							/\s/g,
							""
							)}" style="cursor:pointer">MORE</span>
						</h6>`
							: ""
						}
					`
				);
			}
			} else {
			//console.log(todayArray.length, " LENNN")
			$(".root").append(`${showCalLinks(todayArray.length)}`);
			$(".root").append(
				` <br><br><br>
					<h1 class="text-center">NO EVENTS TODAY</h1>
		<div class="text-center">But you can find events for the following dates:</div>
		<div class="text-center">${showDateLinks()}</div>
				`
			);
			let showTime = setTimeout(() =>{
				clearTimeout(showTime)
				if(isToday == true) {
					//console.log("current date")
					//_timerClick = false
					ResetTimerClick()
				} else {
					//console.log("outside date")
					//_timerClick = false
					ResetTimerClick()
				}
			}, 100)

			}

			$(".active").click(function () {
				var word = $(this).attr("class");
				var lastword = word.replace("active", "");
				var str = lastword.replace(/\s/g, "");
				if ($.trim($("." + str).text()) === "MORE") {
					$("." + str).text("LESS");
				} else {
					$("." + str).text("MORE");
				}
				$(`.hidden_card_${str}`).slideToggle();
			});
		}
	}

	function showDateLinks() {
		let today = new Date();
		let links = "";
		let sortedLinks = new Map(
			[...firstEvents.entries()].sort((a, b) => a[1] - b[1])
		);
		let sep = "";

		sortedLinks.forEach((date, key) => {
			let day = moment(new Date(key)).format("ddd");
			links = links.concat(
			sep,
			/* `<a href=/events?id=${urlid}&date=${key}${sheetParam}>`, */
			/* `<a href=/earshotEvents/earshot__events?id=${urlid}&date=${key}${sheetParam} return false>`, */
			`<a href="#" onClick=FilterRecordsBasedOnDate('`+key+`')>`,
			day,
			"</a>"
			);
			sep = " | ";
		});
		let render = `${links}`;
		return render;
	}

	let _timerClick = false
	function timerClick() {
		
		// Check for date for current or outside
		let pulsateDate = current.format(DATE_FORMAT)
		let matchDate = moment(new Date()).format(DATE_FORMAT)

		if(matchDate == pulsateDate) {
			_timerClick = false
			// Hide
			if($(".root")[0].getElementsByClassName('ak_card_timer')[0] != undefined) {
				$(".root")[0].getElementsByClassName('ak_card_timer')[0].style.display = 'block'

				// Show
				$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.display = 'none'
				$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.display = 'none'
			}
			
			// Animate Icon
			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				$(".root")[0].getElementsByClassName('float-left')[0].style.color = "#222"
			}
		} else {
			_timerClick = true
			// Hide
			if($(".root")[0].getElementsByClassName('ak_card_timer')[0] != undefined) {
				$(".root")[0].getElementsByClassName('ak_card_timer')[0].style.display = 'none'

				// Show
				$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.display = 'block'
				$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.display = 'block'
			}
			
			// Animate Icon
			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				$(".root")[0].getElementsByClassName('float-left')[0].style.color = "red"
			}
		}
	}

	function ResetTimerClick() {
		//console.log("in function - ", _timerClick)
		if(_timerClick) {
			_timerClick = false

			//pulsateTime()
			// Animate Icon
			
			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				$(".root")[0].getElementsByClassName('float-left')[0].style.color = "red"
			}
			
			return
		} else {
			//console.log("borderClick")
			// Animate Icon
			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				$(".root")[0].getElementsByClassName('float-left')[0].style.color = "#222"
			}
			
			// Show
			$(".root")[0].getElementsByClassName('ak_card_timer')[0].style.display = 'block'
			// Hide
			$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.display = 'none'
			$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.display = 'none'

			if(current.format(DISP_FORMAT) != moment(new Date(date + " " + time)).format(DISP_FORMAT)) {
				//window.location.href = "/events?id="+urlid
			}
		}
	}

	let _initEventTime = ''
	let _lastEventTime = ''

	// To Show the active event time
	let isToday = true

	function getUpdatedTime(_format) {
		let utc = new Date();
		let currentUtcStr = "".concat(
		utc.getUTCFullYear(),
		"/",
		utc.getUTCMonth() + 1,
		"/",
		utc.getUTCDate(),
		" ",
		utc.getUTCHours(),
		":",
		utc.getUTCMinutes(),
		":",
		utc.getUTCSeconds()
		);
		let currentUtc = moment(new Date(currentUtcStr));
		//const timeZoneOffset = -4; // EDT
		// const timeZoneOffset = -5; // EST
		let currentAdj = currentUtc.add(timeZoneOffset, "hours");

		let TIME_FORMAT = "MM/DD/YYYY HH:mm";
		let DATE_FORMAT = "MM/DD/YYYY";
		let DISP_FORMAT = "MM/DD ddd hh:mm A";
		let date =
		iDate == null
		? moment(currentAdj).format(DATE_FORMAT)
		: moment(new Date(iDate)).format(DATE_FORMAT);
		let time =
		iTime == null
		? moment(currentAdj).format("HH:mm")
		: moment(new Date(date + " " + iTime)).format("HH:mm");
		let current = moment(new Date(date));
		if ((!iTime && !iDate) || (iTime && iDate)) {
		current = moment(new Date(date + " " + time));
		}

		return currentAdj.format(DISP_FORMAT).split(" ")[2]
	}

	function toHoursAndMinutes(totalMinutes) {
		const minutes = totalMinutes % 60;
		const hours = Math.floor(totalMinutes / 60);

		return `${padTo2Digits(hours)}:${padTo2Digits(minutes)}`;
	}

	function padTo2Digits(num) {
		return num.toString().padStart(2, '0');
	}

	function getUpdatedDate(_dateStr, _timeStr) {
		//console.log("Called - getUpdatedDate")
		/////////////////////////////////////////////////////////////////
		// The event time is not UTC, so we will beed to use timeZoneOffset to find the correct time.
		/* const locSorting = ["Twitch"];
		let sheetParam = "";
		let randomSliderArray = []
		let room = findGetParameter("loc");
		let iDate = findGetParameter("date");
		let iTime = findGetParameter("time");
		let urlid = findGetParameter("id");
		let sheet = findGetParameter("sheet") == "" || findGetParameter("sheet") == null ? "null" : findGetParameter("sheet")
		// The event time is not UTC, so we will beed to use timeZoneOffset to find the correct time.
		let utc = new Date();
		let currentUtcStr = "".concat(
		utc.getUTCFullYear(),
		"/",
		utc.getUTCMonth() + 1,
		"/",
		utc.getUTCDate(),
		" ",
		utc.getUTCHours(),
		":",
		utc.getUTCMinutes(),
		":",
		utc.getUTCSeconds()
		);
		let currentUtc = moment(currentUtcStr);
		const timeZoneOffset = -4; // EDT
		// const timeZoneOffset = -5; // EST
		let currentAdj = currentUtc.add(timeZoneOffset, "hours");

		let TIME_FORMAT = "MM/DD/YYYY HH:mm";
		let DATE_FORMAT = "MM/DD/YYYY";
		let DISP_FORMAT = "MM/DD ddd hh:mm A";
		let ONLY_TIME_FORMAT = "HH:mm";
		let ONLY_MD_FORMAT = "MM/DD HH:mm"
		let date =
		iDate == null
			? moment(currentAdj).format(DATE_FORMAT)
			: moment(new Date(iDate)).format(DATE_FORMAT);
		let time =
		iTime == null
			? moment(currentAdj).format("HH:mm")
			: moment(new Date(date + " " + iTime)).format("HH:mm");
		let current = moment(new Date(date));
		if ((!iTime && !iDate) || (iTime && iDate)) {
		current = moment(new Date(date + " " + time));
		} */
		//console.log(getUpdatedTime(), " HERER")
		/////////////////////////////////////////////////////////////////
			//console.log(response, " Called Data")
			//////////////////////////////////////////////
			if (window.location.href.indexOf("mode=slideshow") != -1) {
				//console.log("TIMER CALLED - ", )
				/* 
				//////////////////////////////////////////////////
				let currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML
				current = moment(new Date());//moment(currentTime, DISP_FORMAT);

				////////////////////////////////////////////////////////////////
				// Store the current day limit
				nDate = new Date(_dateStr);
				nDate.setDate(nDate.getDate() + 1)
				nDate.setHours(0,0,0,0)
				//console.log(nDate, " on Timer Change")
				//////////////////////////////////////////////////
				
				let shownUpnextCount = 0;
				let lastKey = "";


				//console.log(randomSliderArray, " ---- ")
				

				// add image slider
				randomSliderArray
					.map(function (galleryValue, index) {

					//////////////////////////////////////
					let isHappeningNowPresent = false;
					let shownHappeningNowCount = 0;
					let visibleCount = 0;

					//console.log(current , ">=",  moment(new Date(galleryValue.start)))
					//console.log(current , "<",  moment(new Date(galleryValue.end)))


					let isHappeningNow = 0
					if(current < moment(new Date(galleryValue.end))) {
						isHappeningNow =
							current >= moment(new Date(galleryValue.start)) &&
							current < moment(new Date(galleryValue.end));
					} else if(current < moment(new Date(galleryValue.end1))) {
						isHappeningNow =
							current >= moment(new Date(galleryValue.start1)) &&
							current < moment(new Date(galleryValue.end1));
					} else if(current < moment(new Date(galleryValue.end2))) {
						isHappeningNow =
							current >= moment(new Date(galleryValue.start2)) &&
							current < moment(new Date(galleryValue.end2));
					} else if(current < moment(new Date(galleryValue.end3))) {
						isHappeningNow =
							current >= moment(new Date(galleryValue.start3)) &&
							current < moment(new Date(galleryValue.end3));
					} else if(current < moment(new Date(galleryValue.end4))) {
						isHappeningNow =
							current >= moment(new Date(galleryValue.start4)) &&
							current < moment(new Date(galleryValue.end4));
					}

					let isSameDay = 0
					if(current < moment(new Date(galleryValue.end))) {
						isSameDay =
							current.format(DATE_FORMAT) <=
							moment(new Date(galleryValue.start)).format(DATE_FORMAT);
					} else if(current < moment(new Date(galleryValue.end1))) {
						isSameDay =
							current.format(DATE_FORMAT) <=
							moment(new Date(galleryValue.start1)).format(DATE_FORMAT);
					} else if(current < moment(new Date(galleryValue.end2))) {
						isSameDay =
							current.format(DATE_FORMAT) <=
							moment(new Date(galleryValue.start2)).format(DATE_FORMAT);
					} else if(current < moment(new Date(galleryValue.end3))) {
						isSameDay =
							current.format(DATE_FORMAT) <=
							moment(new Date(galleryValue.start3)).format(DATE_FORMAT);
					} else if(current < moment(new Date(galleryValue.end4))) {
						isSameDay =
							current.format(DATE_FORMAT) <=
							moment(new Date(galleryValue.start4)).format(DATE_FORMAT);
					}

					let isUpNext = 0
					if(current < moment(new Date(galleryValue.end))) {
						isUpNext =
							moment(new Date(galleryValue.start)) >= current;
					} else if(current < moment(new Date(galleryValue.end1))) {
						isUpNext =
							moment(new Date(galleryValue.start1)) >= current;
					} else if(current < moment(new Date(galleryValue.end2))) {
						isUpNext =
							moment(new Date(galleryValue.start2)) >= current;
					} else if(current < moment(new Date(galleryValue.end3))) {
						isUpNext =
							moment(new Date(galleryValue.start3)) >= current;
					} else if(current < moment(new Date(galleryValue.end4))) {
						isUpNext =
							moment(new Date(galleryValue.start4)) >= current;
					}

					let isPassed = 0
					if(current < moment(new Date(galleryValue.end))) {
						isPassed =
							moment(new Date(galleryValue.end)) <= current;
					} else if(current < moment(new Date(galleryValue.end1))) {
						isPassed =
							moment(new Date(galleryValue.end1)) <= current;
					} else if(current < moment(new Date(galleryValue.end2))) {
						isPassed =
							moment(new Date(galleryValue.end2)) <= current;
					} else if(current < moment(new Date(galleryValue.end3))) {
						isPassed =
							moment(new Date(galleryValue.end3)) <= current;
					} else if(current < moment(new Date(galleryValue.end4))) {
						isPassed =
							moment(new Date(galleryValue.end4)) <= current;
					}

					let hideEvent = index > shownHappeningNowCount;
					let showEvent =
					isHappeningNow || (isUpNext && !hideEvent);
					if (showEvent) {
					visibleCount++;
					}

					if (lastKey != index) {
						shownUpnextCount = 0;
						shownHappeningNowCount = 0;
						isHappeningNowPresent = false;
					}
					if (!isHappeningNow && isSameDay && isUpNext) {
					shownUpnextCount += 1;
					}
					if (isHappeningNow && shownUpnextCount == 0) {
					isHappeningNowPresent = true;
					shownHappeningNowCount += 1;
					}
					///////////////////////////////////////

					lastKey = index

					//console.log(document.getElementById('happenText').innerHTML)

					console.log(isHappeningNow && isSameDay, " >>>>>>")


					{
						(isHappeningNow && isSameDay) == true
							? document.getElementById('happenText').innerHTML = "HAPPENING NOW" : document.getElementById('happenText').innerHTML = ""`<h6 class="card-title ak_card_subtitle mt-3">HAPPENING NOW</h5>`
							``
						}
						{
						!isHappeningNow &&
						isHappeningNowPresent &&
						isUpNext &&
						isSameDay &&
						shownUpnextCount == 1
							? document.getElementById('upText') != null ? document.getElementById('upText').innerHTML = "UP NEXT" : ""`<h6 class="card-title ak_card_subtitle mt-3">UP NEXT</h5>`
							: document.getElementById('upText') != null ? document.getElementById('upText').innerHTML = "" : ""``
					}

					/////////////////////////////////////////////////////////////////////////////////
					/////////////////////////////////////////////////////////////////////////////////

				}) */
				//////////////////////////////////////////////////
				//////////////////////////
			} // Slideshow Mode ends here
			else {

				//console.log("Filter data")
				//console.log($(".active").text(), ">VAL")
				//return
				// Breaking the auto close of MORE/LESS events

				var hideEventsStat = $(".active").text()

				$(".image_slider").remove()
				$(".card.custom_border_left.mt-2").remove()
				$(".text-center").remove()
				$("br").remove();
				$(".image_id").css("display", "none");
				//return

				var todayArray = [];
				var todayArrayNext = [];
				randomSliderArray = [];

				/* console.log(response.length, " LENGTH")

				response.forEach((q) => {
				let data = {
					code: q.Code,
					name: q.Event,
					speakers: q.Presenters,
					desc: q.Description,
					start: q.Start,
					end: q.End,
					info: q.Info,
					location: q.Location,
					capacity: q.Capacity,
					count: q.Count,
					images: q.Image,
					status: q.Status,
					link1: q.Link1,
					url1: q.Url1,
					link2: q.Link2,
					url2: q.Url2,
					platform: q.Platform,
					accessInfo: q.AccessInfo,
				}; */

				//console.log(sliderData, " >>> ")


				let currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML
				let resultDate = moment(currentTime, DISP_FORMAT);

				////////////////////////////////////////////////////////////////
				// Store the current day limit
				nDate = new Date(_dateStr);
				nDate.setDate(nDate.getDate() + 1)
				nDate.setHours(0,0,0,0)
				//console.log(nDate, " on Timer Change")
				/////////////////////////////////////////////////////////////////

				sliderData[0].forEach((q) => {
					let data = {
						code: q.Code.toString().replace(/dqo/g, '"'),
						name: q.Event.toString().replace(/dqo/g, '"'),
						speakers: q.Presenters.toString().replace(/dqo/g, '"'),
						desc: q.Description.toString().replace(/dqo/g, '"'),
						start: q.Start,
						end: q.End,
						info: q.Info.toString().replace(/dqo/g, '"'),
						location: Number.isFinite((q.Location)) == false ? q.Location : ("SCHEDULED - " + q.Location),
						capacity: q.Capacity.toString().replace(/dqo/g, '"'),
						count: q.Count,
						images: q.Image.toString().replace(/dqo/g, '"'),
						status: q.Status.toString().replace(/dqo/g, '"'),
						link1: q.Link1.toString().replace(/dqo/g, '"'),
						url1: q.Url1.toString().replace(/dqo/g, '"'),
						link2: q.Link2.toString().replace(/dqo/g, '"'),
						url2: q.Url2.toString().replace(/dqo/g, '"'),
						platform: q.Platform.toString().replace(/dqo/g, '"'),
						accessInfo: q.AccessInfo.toString().replace(/dqo/g, '"'),
						start1: q.Start1,
						end1: q.End1,
						start2: q.Start2,
						end2: q.End2,
						start3: q.Start3,
						end3: q.End3,
						start4: q.Start4,
						end4: q.End4,
					};

					//console.log(data.url1);
					//console.log("URL " + data.url1.indexOf("http"));
					// console.log("## " + data.images);
					// console.log("## " + data.images.lastIndexOf("id="));
					//console.log(
					// data.images.substr(
					// data.images.lastIndexOf("id="),
					// data.images.length - 1
					//)
					// );


					if (data.images.includes("https://drive.google.com")) {
						imgid = data.images.substr(
						data.images.lastIndexOf("id="),
						data.images.length - 1
						);
						data.images = "https://drive.google.com/uc?export=view&" + imgid;
					}

					//console.log("CHECK >> " + data.start, " --- ", data.start1);
					//console.log(new Date(data.end), " ------------ ")

					//if (data.location && data.name && data.start && data.end) {
					if (data.location && data.name && (data.start || data.start1 || data.start2 || data.start3 || data.start4) && (data.end || data.end1 || data.end2 || data.end3 || data.end4)) {	
						//console.log(data, " data")
						
						//////////////////////////////////////////////////////////////////////////////////////////////
						// For start date
						let date = new Date(data.start);
						let dateKey = moment(date).format(DATE_FORMAT);

						// For start1 date
						let date1 = new Date(data.start1);
						let dateKey1 = moment(date1).format(DATE_FORMAT);

						// For start2 date
						let date2 = new Date(data.start2);
						let dateKey2 = moment(date2).format(DATE_FORMAT);

						// For start1 date
						let date3 = new Date(data.start3);
						let dateKey3 = moment(date3).format(DATE_FORMAT);

						// For start1 date
						let date4 = new Date(data.start4);
						let dateKey4 = moment(date4).format(DATE_FORMAT);

						//console.log(new Date(data.end))
						//console.log(dateKey, " === ", moment(currentTime, DISP_FORMAT).format(DATE_FORMAT))
						//console.log(moment(new Date(data.end)), " >>> ", resultDate, " && ", dateKey, " == ", current.format(DATE_FORMAT))
						// For start
						if (
							moment(new Date(data.end)) > resultDate && /* dateKey == moment(currentTime, DISP_FORMAT).format(DATE_FORMAT) */
							dateKey == current.format(DATE_FORMAT )
						) {
							// This event is for the given day, and is either happening now, or later in the day
							todayArray.push(data);
						} else

						// For start1
						if (
							moment(new Date(data.end1)) > resultDate && /* dateKey == moment(currentTime, DISP_FORMAT).format(DATE_FORMAT) */
							dateKey1 == current.format(DATE_FORMAT ) &&	moment(new Date(data.start1)) <= resultDate
						) {
							// This event is for the given day, and is either happening now, or later in the day
							todayArray.push(data);
						} else 

						// For start2
						if (
							moment(new Date(data.end2)) > resultDate && /* dateKey == moment(currentTime, DISP_FORMAT).format(DATE_FORMAT) */
							dateKey2 == current.format(DATE_FORMAT ) && moment(new Date(data.start2)) <= resultDate
						) {
							// This event is for the given day, and is either happening now, or later in the day
							todayArray.push(data);
						} else 

						// For start3
						if (
							moment(new Date(data.end3)) > resultDate && /* dateKey == moment(currentTime, DISP_FORMAT).format(DATE_FORMAT) */
							dateKey3 == current.format(DATE_FORMAT ) && moment(new Date(data.start3)) <= resultDate
						) {
							// This event is for the given day, and is either happening now, or later in the day
							todayArray.push(data);
						} else 

						// For start4
						if (
							moment(new Date(data.end4)) > resultDate && /* dateKey == moment(currentTime, DISP_FORMAT).format(DATE_FORMAT) */
							dateKey4 == current.format(DATE_FORMAT ) && moment(new Date(data.start4)) <= resultDate
						) {
							// This event is for the given day, and is either happening now, or later in the day
							todayArray.push(data);
						}

						///////////////////////////////////////////////////////////////////////////////////////////////////

						// Store the first events of the day to create a summary calendar link
						if (firstEvents.has(dateKey)) {
							if (date < firstEvents[dateKey]) {
								firstEvents.set(dateKey, date);
							}
						} else {
							firstEvents.set(dateKey, date);
						}

						// For start1
						/* if (firstEvents.has(dateKey1)) {
							if (date1 < firstEvents[dateKey1]) {
								firstEvents.set(dateKey1, date1);
							}
						} else {
							firstEvents.set(dateKey1, date1);
						} */
					}
				});

				if (room != null) {
				var todayArrayNext = todayArray.filter(
					(item) => item.location.toLowerCase().indexOf(room) > -1
				);
				}

				var todayArrayNext = room != null ? todayArrayNext : todayArray;
				// var sortedArray  = todayArrayNext.sort((a,b) => new Date(a.start) - new Date(b.start));
				//var sortedArray = todayArrayNext.sort(function (a, b) {
				//const aLoc = locSorting.indexOf(a.location);
				//const bLoc = locSorting.indexOf(b.location);

				//console.log(todayArrayNext, " ---- ", resultDate)

				//if (aLoc == -1 && bLoc == -1) {
					//return new Date(a.start) - new Date(b.start);
					/* if(b.start2 != " " || b.start2 != "") {
						return new Date(a.start) - new Date(b.start1) - new Date(b.start2) 
					} else if(b.start1 != " " || b.start1 != "") {
						return new Date(a.start) - new Date(b.start1) 
					} else { */
				//		return new Date(a.start) - new Date(b.start) 
					//}
				//}
				//if (aLoc == -1) {
				//	return 1;
				//}
				//if (bLoc == -1) {
				//	return -1;
				//}
				//return new Date(a.start) - new Date(b.start);
				/* if(b.start2 != " " || b.start2 != "") {
					return new Date(a.start) - new Date(b.start1) - new Date(b.start2) 
				} else if(b.start1 != " " || b.start1 != "") {
					return new Date(a.start) - new Date(b.start1) 
				} else { */
					//return new Date(a.start) - new Date(b.start) 
				//}
				//});

				////////////////////////////////////////////////////////////////////////////////////////////////////////////

				//console.log(new Date(resultDate), " result Date")

				/* function getSortedArr() {
					return [...todayArrayNext].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					if (aLoc == -1 && bLoc == -1) {
						if(b.start2 != '') {
							return Date.parse(a.start) - Date.parse(b.Start2)  
						} else if(b.start1 != '') {
								return Date.parse(a.start) - Date.parse(b.start1) 
						} else {
							return Date.parse(a.start) - Date.parse(b.start) 
						}
						
					}
					if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					}
					if(b.start2 != '') {
						return Date.parse(a.start) - Date.parse(b.Start2)  
					} else if(b.start1 != '') {
							return Date.parse(a.start) - Date.parse(b.start1) 
					} else {
						return Date.parse(a.start) - Date.parse(b.start) 
					}
					})
				}

				var sortedArray = getSortedArr() */

				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				function getSortedArr(todayArrayNext) {
					return [...todayArrayNext].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							return new Date(a.start) - new Date(b.start)
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						return new Date(a.start) - new Date(b.start)
					})
				}
				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				// Sort Based on Start 1
				/* function getSortedArrStart2(sortStart) {
					return [...sortStart].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							//console.log(b.start2, ">>>>", new Date(a.start), " >= ", resultDate)
							if(b.start2 != "" && new Date(b.start2) >= resultDate) {
								console.log(new Date(b.start2) , " - ", new Date(a.start))
								return new Date(a.start) - new Date(b.start2)
							} 
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						if(b.start2 != "" && new Date(a.start2) >= resultDate) {
							return new Date(a.start) - new Date(b.start2)
						} 
					})
				} */

				function getSortedArrStart1(sortStart) {
					return [...sortStart].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
								return new Date(b.start) - new Date(a.start)
							} else {
								if(b.start1 != "" && new Date(b.start1) >= resultDate && new Date(b.start1) < nDate) {
									//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
									return new Date(a.start) - new Date(b.start1)
								} 
							}
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						/* if(b.start2 != "" && new Date(b.start2) >= new Date(selectedDate)) {
							return new Date(a.start) - new Date(b.start2)
						} */ 
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start1 != "" && new Date(b.start1) >= resultDate && new Date(b.start1) < nDate) {
								//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start1)
							} 
						}
					})
				}

				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				// Sort Based on Start 1
				/* function getSortedArrStart1(sortStart2) {
					return [...sortStart2].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							if(b.start1 != '' && new Date(b.start1) >= resultDate) {
								//console.log(new Date(b.start1) , " - ", new Date(a.start))
								return new Date(a.start) - new Date(b.start1)
							}
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						if(b.start1 != '' && new Date(b.start1) >= resultDate) {
							return new Date(a.start) - new Date(b.start1)
						}
					})
				} */
				// Sort Based on Start 2
				function getSortedArrStart2(sortStart2) {
					return [...sortStart2].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
								return new Date(b.start) - new Date(a.start)
							} else {
								if(b.start2 != "" && new Date(b.start2) >= resultDate && new Date(b.start2) < nDate) {
									//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
									return new Date(a.start) - new Date(b.start2)
								}
							}
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						/* if(b.start1 != '' && new Date(b.start1) >= new Date(selectedDate)) {
							return new Date(a.start) - new Date(b.start1)
						} */
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start2 != "" && new Date(b.start2) >= resultDate && new Date(b.Start2) < nDate) {
								//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start2)
							}
						}
					})
				}

				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				// Sorting Order
				////////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////////
				// Previous
				/* let sortStart = getSortedArr(todayArrayNext)
				let sortStart2 = getSortedArrStart1(sortStart)
				let sortedArray = getSortedArrStart2(sortStart2) */
				// New
				// Clear All Containers
				outputInit = [];
				output1 = [];
				output1_1 = [];
				output1_2 = [];
				output2 = [];
				output2_1 = [];
				output2_2 = [];
				output3 = [];
				// Reassing Values to those containers
				let mFormat = doFormat(todayArrayNext, nDate)
				let mFormat1 = doFormat1(mFormat, nDate)
				let mFormat2 = doFormat2(mFormat1, nDate)
				let mFormat1_1 = doFormat3(mFormat2, nDate)
				let mFormat2_1 = doFormat1_1(mFormat1_1, nDate)
				let mFormat2_2 = doFormat2_1(mFormat2_1, nDate)
				let sortedArray = doFormat2_2(mFormat2_2, nDate)

				//let sortedArray = doFormat(sortedArray1, nDate)

				//console.log(sortedArray, " > on Sorted")
				////////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////////////////////////////////////////////

				var slideObjArr = [];

				var output = sortedArray.reduce(function (result, value) {
					var location = value.location;
					result[location] = result[location] || [];
						result[location].push({
							code: value.code,
							name: value.name,
							speakers: value.speakers,
							desc: value.desc,
							start: value.start,
							end: value.end,
							info: value.info,
							location: value.location,
							capacity: value.capacity,
							images: value.images,
							count: value.count,
							status: value.status,
							link1: value.link1,
							url1: value.url1,
							link2: value.link2,
							url2: value.url2,
							platform: value.platform,
							accessInfo: value.accessInfo,
							start1: value.start1,
							end1: value.end1,
							start2: value.start2,
							end2: value.end2,
							start3: value.start3,
							end3: value.end3,
							start4: value.start4,
							end4: value.end4,
						});
					return result;
				}, {});

				if (
				(Object.keys(output).length === 0 &&
					output.constructor === Object) == false
				) {
				var counter = "";
				let entries = Object.entries(output);
				for (let [index, [key, value]] of entries.entries()) {
					slideObjArr.push(value[0]);
					//console.log("index:"+index  + " Key:"+ key + " value:"+ value)
				}
				
				//console.log(slideObjArr, " BEFORE");
				let randomSliderArray = slideObjArr.sort(() => Math.random() - 0.5);
				//console.log(randomSliderArray, " AFTER");
				
				// console.log(randomSliderArray);
				let shownUpnextCount = 0;
				let lastKey = "";

				//$(".root").append(`${showCalLinks()}`);

				//console.log(todayArray, " >>>>")

				//_initEventTime = todayArray[0].start
				//_lastEventTime = todayArray[todayArray.length-1].end

				// add image slider
				$(".root").append(
					`
						<div class="mt-2 image_slider" >
							${randomSliderArray
							.map(function (galleryValue, index) {
								return `
								${
								galleryValue.images
									? `
								<a class="px-2" href="#${galleryValue.location
									.toLowerCase()
									.replace(/\s/g, "")}">
								<div class="expect_ratio_images">
									<img src="${
									galleryValue.images
									}" class="ak_img_detail">
								</div>
								<div class="ak_img_desc">${galleryValue.name}
								</div>
								</a>
								`
									: `

								`
								}
								`;
							})
							.join("")}
						</div>
						`
				);

				$(".image_slider").slick({
					dots: false,
					arrows: true,
					infinite: true,
					speed: 300,
					autoplay: true,
					slidesToShow: 7,
					slidesToScroll: 2,
					responsive: [
					{
						breakpoint: 1199,
						settings: {
						slidesToShow: 6,
						slidesToScroll: 6,
						infinite: true,
						dots: true,
						},
					},
					{
						breakpoint: 999,
						settings: {
						slidesToShow: 5,
						slidesToScroll: 5,
						infinite: true,
						dots: true,
						},
					},
					{
						breakpoint: 768,
						settings: {
						slidesToShow: 3,
						slidesToScroll: 3,
						},
					},
					{
						breakpoint: 568,
						settings: {
						slidesToShow: 1,
						slidesToScroll: 1,
						},
					},
					]
				});
				for (let [index, [key, value]] of entries.entries()) {
					color = colors[index % colors.length];

					//slideObjArr.push(value[0]);
					//console.log("index:"+index  + " Key:"+ key + " value:"+ value)
					// console.log(
					//  "1_index:" + index + " Key:" + key + " value:" + value[0].url1
					// );
					//              var path = (value[0].url1)

					/* if (value[0].url1.length > 0) {
					if (
						value[0].url1.indexOf("http://") === -1 ||
						value[0].url1.indexOf("https://") === -1
					) {
						value[0].url1 = "http://" + value[0].url1;
					}
					}
					*/

					//if (urlString.indexOf('http://') === 0 || urlString.indexOf('https://') === 0)

					// console.log("akhm"+(path.isAbsolute));

					let button1 = value[0].url1
					? `
						<a href=${`${value[0].url1}`} target="_blank">
							<button type="button" class="btn btn-outline-light float-right mt-310">${
							value[0].link1
							}</button>
						</a>`
					: "";

					let button2 = value[0].url2
					? `
						<a href=${`${value[0].url2}`} target="_blank">
							<button type="button" class="btn btn-outline-light float-right mt-310">${
							value[0].link2
							}</button>
						</a>`
					: "";

					let platform = value[0].platform
					? `
							<div class="tabletop-sim float-right">${value[0].platform} | ${value[0].accessInfo}</div>
						`
					: "";

					let isHappeningNowPresent = false;
					let shownHappeningNowCount = 0;
					let visibleCount = 0;


					$(".root").append(
					`
							<div class="card custom_border_left mt-2" style="border-left-color:#${color}">
								<div class="card-header ak_card_header" style="background:#${color}">

								<h4 class="card-room d-inline" id="${key
									.toLowerCase()
									.replace(/\s/g, "")}">${key}</h4>

								${button2}
								${button1}

								</div>



								${value
								.map(function (que, index) {

									/* let isHappeningNow =
									current >= moment(new Date(que.start)) &&
									current < moment(new Date(que.end)); */
									
									let isHappeningNow = 0
									if(resultDate < moment(new Date(que.end))) {
										if(isToday) {
											isHappeningNow = resultDate >= moment(new Date(que.start)) &&
											resultDate < moment(new Date(que.end));
										} else {
											isHappeningNow = current >= moment(new Date(que.start)) &&
											current < moment(new Date(que.end));
										}
									} else if(resultDate < moment(new Date(que.end1))) {
										if(isToday) {
											isHappeningNow = resultDate >= moment(new Date(que.start1)) &&
											resultDate < moment(new Date(que.end1));
										} else {
											isHappeningNow = current >= moment(new Date(que.start1)) &&
											current < moment(new Date(que.end1));
										}
									} else if(resultDate < moment(new Date(que.end2))) {
										if(isToday) {
											isHappeningNow = resultDate >= moment(new Date(que.start2)) &&
											resultDate < moment(new Date(que.end2));
										} else {
											isHappeningNow = current >= moment(new Date(que.start2)) &&
											current < moment(new Date(que.end2));
										}
									} else if(resultDate < moment(new Date(que.end3))) {
										if(isToday) {
											isHappeningNow = resultDate >= moment(new Date(que.start3)) &&
											resultDate < moment(new Date(que.end3));
										} else {
											isHappeningNow = current >= moment(new Date(que.start3)) &&
											current < moment(new Date(que.end3));
										}
									} else if(resultDate < moment(new Date(que.end4))) {
										if(isToday) {
											isHappeningNow = resultDate >= moment(new Date(que.start4)) &&
											resultDate < moment(new Date(que.end4));
										} else {
											isHappeningNow = current >= moment(new Date(que.start4)) &&
											current < moment(new Date(que.end4));
										}
									}
									/////////////////////////////////////////////////////////////////////////////
									// Find Timer current
									//console.log(moment(new Date()), " ==== ", moment(new Date(que.start)))
									// Find Current
									//console.log(current, " >>> current")

									/////////////////////////////////////////////////////////////////////////////

									/* let isSameDay =
									current.format(DATE_FORMAT) ==
									moment(new Date(que.start)).format(DATE_FORMAT); */

									let isSameDay = 0
									if(resultDate < moment(new Date(que.end))) {
										if(isToday) {
											isSameDay = resultDate.format(DATE_FORMAT) <=
											moment(new Date(que.start)).format(DATE_FORMAT)
										} else {
											isSameDay = current.format(DATE_FORMAT) <=
											moment(new Date(que.start)).format(DATE_FORMAT)}
									} else if(resultDate < moment(new Date(que.end1))) {
										if(isToday) {
											isSameDay = resultDate.format(DATE_FORMAT) <=
											moment(new Date(que.start1)).format(DATE_FORMAT)
										} else {
											isSameDay = current.format(DATE_FORMAT) <=
											moment(new Date(que.start1)).format(DATE_FORMAT)
										}
									} else if(resultDate < moment(new Date(que.end2))) {
										if(isToday) {
											isSameDay = resultDate.format(DATE_FORMAT) <=
											moment(new Date(que.start2)).format(DATE_FORMAT)
										} else {
											isSameDay = current.format(DATE_FORMAT) <=
											moment(new Date(que.start2)).format(DATE_FORMAT)
										}
									} else if(resultDate < moment(new Date(que.end3))) {
										if(isToday) {
											isSameDay = resultDate.format(DATE_FORMAT) <=
											moment(new Date(que.start3)).format(DATE_FORMAT)
										} else {
											isSameDay = current.format(DATE_FORMAT) <=
											moment(new Date(que.start3)).format(DATE_FORMAT)
										}
									} else if(resultDate < moment(new Date(que.end4))) {
										if(isToday) {
											isSameDay = resultDate.format(DATE_FORMAT) <=
											moment(new Date(que.start4)).format(DATE_FORMAT)
										} else {
											isSameDay = current.format(DATE_FORMAT) <=
											moment(new Date(que.start4)).format(DATE_FORMAT)
										}
									}

									/* let isUpNext =
									moment(new Date(que.start)) >= current; */
									let isUpNext = 0
									if(resultDate < moment(new Date(que.end))) { 
										if(isToday) {
											isUpNext = moment(new Date(que.start)) >= resultDate;
										} else {
											isUpNext = moment(new Date(que.start)) >= current;
										}
									} else if(resultDate < moment(new Date(que.end1))) { 
										if(isToday) {
											isUpNext = moment(new Date(que.start1)) >= resultDate;
										} else {
											isUpNext = moment(new Date(que.start1)) >= current;
										}
									} else if(resultDate < moment(new Date(que.end2))) { 
										if(isToday) {
											isUpNext = moment(new Date(que.start2)) >= resultDate;
										} else {
											isUpNext = moment(new Date(que.start2)) >= current;
										}
									} else if(resultDate < moment(new Date(que.end3))) { 
										if(isToday) {
											isUpNext = moment(new Date(que.start3)) >= resultDate;
										} else {
											isUpNext = moment(new Date(que.start3)) >= current;
										}
									} else if(resultDate < moment(new Date(que.end4))) { 
										if(isToday) {
											isUpNext = moment(new Date(que.start4)) >= resultDate;
										} else {
											isUpNext = moment(new Date(que.start4)) >= current;
										}
									}

									/* let isPassed =
									moment(new Date(que.end)) <= current; */
									let isPassed = 0
									if(resultDate < moment(new Date(que.end))) { 
										if(isToday) {
											isPassed = moment(new Date(que.end)) <= resultDate;
										} else {
											isPassed = moment(new Date(que.end)) <= current;
										}
									} else if(resultDate < moment(new Date(que.end1))) { 
										if(isToday) {
											isPassed = moment(new Date(que.end1)) <= resultDate;
										} else {
											isPassed = moment(new Date(que.end1)) <= current;
										}
									} else if(resultDate < moment(new Date(que.end2))) { 
										if(isToday) {
											isPassed = moment(new Date(que.end2)) <= resultDate;
										} else {
											isPassed = moment(new Date(que.end2)) <= current;
										}
									} else if(resultDate < moment(new Date(que.end3))) { 
										if(isToday) {
											isPassed = moment(new Date(que.end3)) <= resultDate;
										} else {
											isPassed = moment(new Date(que.end3)) <= current;
										}
									} else if(resultDate < moment(new Date(que.end4))) { 
										if(isToday) {
											isPassed = moment(new Date(que.end4)) <= resultDate;
										} else {
											isPassed = moment(new Date(que.end4)) <= current;
										}
									}

									let hideEvent = index > shownHappeningNowCount;
									let showEvent =
									isHappeningNow || (isUpNext && !hideEvent);
									if (showEvent) {
										visibleCount++;
									}

									if (lastKey != key) {
										shownUpnextCount = 0;
										shownHappeningNowCount = 0;
										isHappeningNowPresent = false;
									}
									if (!isHappeningNow && isSameDay && isUpNext) {
										shownUpnextCount += 1;
									}
									if (isHappeningNow && shownUpnextCount == 0) {
										isHappeningNowPresent = true;
										shownHappeningNowCount += 1;
									}

									lastKey = key;

									let dispDate = ""
									if(resultDate < moment(new Date(que.end)) && new Date(que.end) < nDate) {
										//console.log(key, " show start/end")
										dispDate = moment(new Date(que.start)).format("dddd hh:mm A") + " - " + moment(new Date(que.end)).format("hh:mm A")
									} else if(resultDate < moment(new Date(que.end1)) && new Date(que.end1) < nDate) {
										//console.log(key, " show start1/end1")
										dispDate = moment(new Date(que.start1)).format("dddd hh:mm A") + " - " + moment(new Date(que.end1)).format("hh:mm A")
									} else if(resultDate < moment(new Date(que.end2)) && new Date(que.end2) < nDate) {
										//console.log(key, " show start2/end2")
										dispDate = moment(new Date(que.start2)).format("dddd hh:mm A") + " - " + moment(new Date(que.end2)).format("hh:mm A")
									}
									//console.log("Fired : MORE OR LESS CHANGES")
									//console.log(que.name, {isHappeningNow: isHappeningNow, isSameDay: isSameDay, isUpNext: isUpNext, isPassed: isPassed, visibleCount: visibleCount, shownUpnextCount: shownUpnextCount, hideEvent: hideEvent, showEvent: showEvent, shownHappeningNowCount: shownHappeningNowCount, length: value.length, index: index, hasMore: hasMore});

									return `

										${
										shownUpnextCount == 0 &&
										isSameDay &&
										isUpNext &&
										!isHappeningNow
											? `<h5 class="card-title ak_card_subtitle mt-3 ml-3">NO CURRENT EVENT ${index}</h5>`
											: ``
										}

										${
										!isPassed && isSameDay
											? `${`
										<div class="${
											isHappeningNow && isSameDay
											? "card-body"
											: "card-footer ak_card_footer"
										} ${
												hideEvent
												? `hidden_card_${key.replace(
													/\s/g,
													""
													)}`
												: ""
											}"
											style="${
											showEvent
												? "display:block"
												/* : (hideEventsStat === "MORE" ? "display:none"  */
												: "display:none"
											}"
											id="
											${que.name
											.toLowerCase()
											.replace(/\s/g, "")}
											"
											>

											${
											isHappeningNow &&
											shownHappeningNowCount < 2/*  &&
											isSameDay */
												? `<h5 class="card-title ak_card_subtitle mt-3">HAPPENING NOW</h5>`
												: ``
											}
											${
											!isHappeningNow &&
											isHappeningNowPresent &&
											isUpNext &&
											isSameDay &&
											shownUpnextCount == 1
												? `<h5 class="card-title ak_card_subtitle mt-3">UP NEXT</h5>`
												: ``
											}
											<!--MULTIPLE////////////////////////////////////////////////////////////////////////////// -->
											<span class="card-text ak_room_title">${
											que.code
											} - ${que.name}</span>
											<span>${showStatus(que)}</span>
											<span class="float-right ak_date">${dispDate/* (resultDate < moment(new Date(que.end))) ? moment(
											new Date(que.start)
											).format("dddd hh:mm A") : (resultDate < moment(new Date(que.end1))) ? moment(
											new Date(que.start1)
											).format("dddd hh:mm A") : (resultDate < moment(new Date(que.end2))) ? moment(
											new Date(que.start2)
											).format("dddd hh:mm A") : (resultDate < moment(new Date(que.end3))) ? moment(
											new Date(que.start3)
											).format("dddd hh:mm A") : (resultDate < moment(new Date(que.end4))) ? moment(
											new Date(que.start4)
											).format("dddd hh:mm A") : ''} - ${(resultDate < moment(new Date(que.end))) ? moment(
												new Date(que.end)
											).format("hh:mm A") : (resultDate < moment(new Date(que.end1))) ? moment(
												new Date(que.end1)
											).format("hh:mm A") : (resultDate < moment(new Date(que.end2))) ? moment(
												new Date(que.end2)
											).format("hh:mm A") : (resultDate < moment(new Date(que.end3))) ? moment(
												new Date(que.end3)
											).format("hh:mm A") : (resultDate < moment(new Date(que.end4))) ? moment(
												new Date(que.end4)
											).format("hh:mm A") : '' */}</span>
											<!--////////////////////////////////////////////////////////////////////////////// -->
											<br>
											<b style="color: black !important;">${
											que.speakers
											}</b><br>
											<div class="ak_room_descp mt-3">
											${
												!que.images
												? `

											`
												: `
											<img class="ak_desc_img" data-toggle="modal" data-target="#${que.name
												.toLowerCase()
												.replace(/\s/g, "")}" src=${
													que.images
													} />
											<div class="modal fade" id="${que.name
												.toLowerCase()
												.replace(
												/\s/g,
												""
												)}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
											<div class="modal-dialog modal-xl" role="document">
												<button type="button" class="close close-modal p-4" data-dismiss="modal" aria-label="Close">
												<span aria-hidden="true">&times;</span>
												</button>
												<img src=${
												que.images
												} class="img-fluid modal-image" />
												<span class="px-4 py-2 d-block">${
												que.name
												}</span>
											</div>
											</div>
											`
											}

											<span class="d-inline-block ${
												!que.images ? ` ` : `nay_des`
											}">${que.desc}</span>
											</div>


											<div class="info float-left">${
											que.info
											}</div>
											${platform}
											</div>

											`}`
											: ``
										}
										`;
								})
								.join("")
							}
							${
								value.length > visibleCount 
								? `<h6 class="text-center more pb-3">
								<span class="active ${key.replace(
								/\s/g,
								""
								)}" style="cursor:pointer">MORE</span>
							</h6>`
								: ""
							}
						`
					);
				}
				} else {
				//$(".root").append(`${showCalLinks()}`);
				//console.log(todayArray.length, " LENNN")
				$(".root").append(
					` <br><br><br>
						<h1 class="text-center">NO EVENTS TODAY</h1>
				<div class="text-center">But you can find events for the following dates:</div>
				<div class="text-center">${showDateLinks()}</div>
					`
				);
				}

				$(".active").click(function () {
				var word = $(this).attr("class");

				var lastword = word.replace("active", "");

				var str = lastword.replace(/\s/g, "");

				if ($.trim($("." + str).text()) === "MORE") {
					$("." + str).text("LESS");
				} else {
					$("." + str).text("MORE");
				}
				$(`.hidden_card_${str}`).slideToggle();
				});
			}
				///////////////////////////////////////////////
			/* },
		}) */
	}

	function timerPlusClick() {
		_timerClick = true
		if($(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity == 0.2) {return}
		
		let currentTime = ""
		if (window.location.href.indexOf("mode=slideshow") != -1) {
			//currentTime = $(".root")[0].getElementsByClassName('time')[0].innerHTML
		} else {
			currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML
		}
		let resultDate = moment(currentTime, DISP_FORMAT); // this will be valid moment date now
		
		if (window.location.href.indexOf("mode=slideshow") != -1) {
			/* for(let i=0; i<randomSliderArray.length; i++) {
				if(document.getElementById(i) !== null) {
					document.getElementById(i).innerHTML = resultDate.add(30, 'minutes').format(DISP_FORMAT)
				}
			} */
		} else {
			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = resultDate.add(30, 'minutes').format(DISP_FORMAT)
			}
		}

		//setTimeout(function() {
		// Format Date and Time
		//console.log(resultDate.add(30, 'minutes').format(DISP_FORMAT), " sent date")
		//let updatedTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML
		let updatedResultDate = ""
		if (window.location.href.indexOf("mode=slideshow") != -1) {
			//updatedResultDate = moment($(".root")[0].getElementsByClassName('time')[0].innerHTML, DISP_FORMAT);
		} else {
			updatedResultDate = moment($(".root")[0].getElementsByClassName('float-left')[0].innerHTML, DISP_FORMAT);
		}
		let lookupDate = updatedResultDate.format(DATE_FORMAT)
		let lookupTime = updatedResultDate.format(ONLY_TIME_FORMAT)
		//console.log(lookupDate, " ---- ", lookupTime)
		getUpdatedDate(lookupDate, lookupTime)
		//},3000)
	}

	function timerMinusClick() {
		_timerClick = true
		if($(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity == 0.2) {return}
		
		//let currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML

		let currentTime = ""
		if (window.location.href.indexOf("mode=slideshow") != -1) {
			//currentTime = $(".root")[0].getElementsByClassName('time')[0].innerHTML
		} else {
			currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML
		}

		let resultDate = moment(currentTime, DISP_FORMAT); // this will be valid moment date now
		
		if (window.location.href.indexOf("mode=slideshow") != -1) {
			/* for(let i=0; i<randomSliderArray.length; i++) {
				if(document.getElementById(i) !== null) {
					document.getElementById(i).innerHTML = resultDate.add(-30, 'minutes').format(DISP_FORMAT)
				}
			} */
		} else {
			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
			$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = resultDate.add(-30, 'minutes').format(DISP_FORMAT)
		}
		}

		let updatedResultDate = moment($(".root")[0].getElementsByClassName('float-left')[0].innerHTML, DISP_FORMAT);
		let lookupDate = updatedResultDate.format(DATE_FORMAT)
		let lookupTime = updatedResultDate.format(ONLY_TIME_FORMAT)
		//console.log(lookupDate, " ---- ", lookupTime)
		getUpdatedDate(lookupDate, lookupTime)
	}

	function showCalLinks(_items) {
		//console.log("Callec - showCalledLinks")
		let today = new Date();
		let to_day = moment(today).format(DATE_FORMAT)


		//console.log(isToday, " >> isToday")

		//let showDate = null

		/* if(iDate != null) {
			showDate = moment(new Date(iDate)).format(DISP_FORMAT)
		} else {
			showDate = moment(new Date()).format(DISP_FORMAT)
		} */

		////////////////////////////////////////////////////
		/* 
		const locSorting = ["Twitch"];
		let sheetParam = "";
		let randomSliderArray = []
		let room = findGetParameter("loc");
		let iDate = findGetParameter("date");
		let iTime = findGetParameter("time");
		let urlid = findGetParameter("id");
		let sheet = findGetParameter("sheet") == "" || findGetParameter("sheet") == null ? "null" : findGetParameter("sheet")

		/////////////////////
		let TIME_FORMAT = "MM/DD/YYYY HH:mm";
		let DATE_FORMAT = "MM/DD/YYYY";
		let DISP_FORMAT = "MM/DD ddd hh:mm A";
		let ONLY_TIME_FORMAT = "HH:mm";
		let ONLY_MD_FORMAT = "MM/DD HH:mm"


		let utc = new Date();
		let currentUtcStr = "".concat(
		utc.getUTCFullYear(),
		"/",
		utc.getUTCMonth() + 1,
		"/",
		utc.getUTCDate(),
		" ",
		utc.getUTCHours(),
		":",
		utc.getUTCMinutes(),
		":",
		utc.getUTCSeconds()
		);
		let currentUtc = moment(currentUtcStr);
		const timeZoneOffset = -4; // EDT
		// const timeZoneOffset = -5; // EST
		let currentAdj = currentUtc.add(timeZoneOffset, "hours");

		var selectedDate = moment(new Date(_val)).format(DATE_FORMAT)
		var currenDate = moment(new Date()).format(DATE_FORMAT)

		/////////////////////////////////////////////////////////////////
		let date =
		iDate == null
			? moment(currentAdj).format(DATE_FORMAT)
			: moment(new Date(iDate)).format(DATE_FORMAT);
		let time =
		iTime == null
			? moment(currentAdj).format("HH:mm")
			: moment(new Date(date + " " + iTime)).format("HH:mm");
		let current = moment(new Date(date));
		if (((!iTime && !iDate) || (iTime && iDate)) && (selectedDate === currenDate)) {
			current = moment(new Date(date + " " + time));
		} */
		//current = moment(new Date());

		/////////////////////////////////////////////////////
		//let links = `<a href="/events?date=${moment(today).format('MM/DD/YYYY')}&id=${urlid}">NOW</a>`;

		let links = `<a href="#" onClick="FilterRecordsBasedOnDate('`+ to_day +`')">NOW</a>`;
		//let links = `<a href="/events?id=${urlid}${sheetParam}">NOW</a>`;
		
		
		let sortedLinks = new Map(
			[...firstEvents.entries()].sort((a, b) => a[1] - b[1])
		);


		//console.log(_items, " Length")

		//console.log(_initEventTime, " timer")
		// current.format(DISP_FORMAT
		//console.log(_initEventTime, " _initEventTime")
		let initCurrentTime = ""

		if(_initEventTime == "") {
			initCurrentTime = current.format(DISP_FORMAT)
		} else {
			initCurrentTime = moment(new Date(_initEventTime)).format(DISP_FORMAT)
		}

		sortedLinks.forEach((date, key) => {
			let day = moment(new Date(key)).format("DD");
			links = links.concat(
				` | <a href="#" onClick=FilterRecordsBasedOnDate('`+key+`')>`,
			/* ` | <a href=/events?id=${urlid}&date=${key}${sheetParam}>`, */
			
			day,
			"</a>"
			);
		});

		let render = ""

		if (window.location.href.indexOf("mode=slideshow") != -1) {
			render = `
				<div class="card custom_border_left mt-5" style="border-left-color:red">
					<div class="card-header ak_card_header" style="background:#cccccc">
						<div class="float-left" style="margin-left:40px">${_items == 0 || isToday == true ? current.format(DISP_FORMAT) /* currentAdj.format(DISP_FORMAT) */  /* moment(new Date()).format(DISP_FORMAT) */ /* showDate */ : initCurrentTime}</div>
						<div class="float-right">
						${links}
						</div>
					</div>
				</div>
				`;
		} else {
			render = `
				<div class="card custom_border_left mt-5" style="border-left-color:red">
					<div class="card-header ak_card_header" style="background:#cccccc" onclick="ResetTimerClick()">
						
						<div class="card-header ak_card_timer">
							<img id="editTimer" src="images/ear_icon_time.png" width="90px" height="90px" alt="" onclick="timerClick()" />
						</div>
						<div class="card-header ak_card_minus">
							<img id="editTimer" src="images/ear_icon_minus.png" width="90px" height="90px" alt="" onclick="timerMinusClick()" />
						</div>

						
						<div class="float-left" style="margin-left:40px">${_items == 0 || isToday == true ? current.format(DISP_FORMAT) /* currentAdj.format(DISP_FORMAT) */  /* moment(new Date()).format(DISP_FORMAT) */ /* showDate */ : initCurrentTime}</div>


						<div class="card-header ak_card_plus">
							<img id="editTimer" src="images/ear_icon_plus.png" width="90px" height="90px" alt="" onclick="timerPlusClick()" />
						</div>
						

						<div class="float-right">
						${links}
						</div>
					</div>
				</div>
				`;
		}
		return render;
	}

	function showImageSlide(imgslider) {
		let render = `
			<div class="card mt-2  ak_img">

			</div>
			`;
		return render;
	}

	const colors = [
		"ff9966",
		"996633",
		"cc6633",
		"669966",
		"339966",
		"33cc99",
		"339999",
		"339966",
		"33cc99",
	];


	let sliderData = []
	let mPulsateTimer = 0
	// New Addition
	let updateTimeTimer = 0

	// Locations in this list will be sorted first
	
	const locSorting = ["Twitch"];

	let sheetParam = "";
	let randomSliderArray = []
	//let apiListurl = "https://sheetdb.io/api/v1/"
	let room = findGetParameter("loc");
	let iDate = findGetParameter("date");
	let iTime = findGetParameter("time");
	let urlid = findGetParameter("id");
	//let sheet = findGetParameter("sheet") == undefined ? findGetDefaultSheet(urlid) : findGetParameter("sheet");
	//console.log(findGetParameter("sheet"), " sheetINIT")
	let sheet = findGetParameter("sheet") == "" || findGetParameter("sheet") == null ? "null" : findGetParameter("sheet")

	//let apiurl = "https://sheetdb.io/api/v1/" + urlid;
	
	
	/* if (sheet != "") {
		// If the Google Sheet has multiple tabs, it has to be the first tab. If not, pass the name of the 'sheet'.
		sheetParam = "&sheet=" + sheet;
		apiurl += "?sheet=" + sheet;
	}  */
	
	// The event time is not UTC, so we will beed to use timeZoneOffset to find the correct time.
	let utc = new Date();
	let currentUtcStr = "".concat(
	utc.getUTCFullYear(),
	"/",
	utc.getUTCMonth() + 1,
	"/",
	utc.getUTCDate(),
	" ",
	utc.getUTCHours(),
	":",
	utc.getUTCMinutes(),
	":",
	utc.getUTCSeconds()
	);

	//console.log(currentUtcStr, " CCTC")

	/////////////////////////////////////////////////////

	let nDate = 0

	/////////////////////////////////////////////////////

	let currentUtc = moment(new Date(currentUtcStr));
	const timeZoneOffset = -4; // EDT
	// const timeZoneOffset = -5; // EST
	let currentAdj = currentUtc.add(timeZoneOffset, "hours");

	let TIME_FORMAT = "MM/DD/YYYY HH:mm";
	let DATE_FORMAT = "MM/DD/YYYY";
	let DISP_FORMAT = "MM/DD ddd hh:mm A";
	let ONLY_TIME_FORMAT = "HH:mm";
	let ONLY_MD_FORMAT = "MM/DD HH:mm"
	let date =
	iDate == null
		? moment(currentAdj).format(DATE_FORMAT)
		: moment(new Date(iDate)).format(DATE_FORMAT);
	let time =
	iTime == null
		? moment(currentAdj).format("HH:mm")
		: moment(new Date(date + " " + iTime)).format("HH:mm");
	let current = moment(new Date(date));
	if ((!iTime && !iDate) || (iTime && iDate)) {
	current = moment(new Date(date + " " + time));
	}

	

	///////////////////////////////////////////////////
	upDateTime();
	function upDateTime(){
		let utc = new Date();
		let currentUtcStr = "".concat(
		utc.getUTCFullYear(),
		"/",
		utc.getUTCMonth() + 1,
		"/",
		utc.getUTCDate(),
		" ",
		utc.getUTCHours(),
		":",
		utc.getUTCMinutes(),
		":",
		utc.getUTCSeconds()
		);
		let currentUtc = moment(new Date(currentUtcStr));
		//const timeZoneOffset = -4; // EDT
		// const timeZoneOffset = -5; // EST
		let currentAdj = currentUtc.add(timeZoneOffset, "hours");

		let TIME_FORMAT = "MM/DD/YYYY HH:mm";
		let DATE_FORMAT = "MM/DD/YYYY";
		let DISP_FORMAT = "MM/DD ddd hh:mm A";
		let date =
		iDate == null || undefined || " "
		? moment(currentAdj).format(DATE_FORMAT)
		: moment(new Date(iDate)).format(DATE_FORMAT);
		let time =
		iTime == null
		? moment(currentAdj).format("HH:mm")
		: moment(new Date(date + " " + iTime)).format("HH:mm");
		let current = moment(new Date(date));
		if ((!iTime && !iDate) || (iTime && iDate)) {
			current = moment(new Date(date + " " + time));
		}

		//console.log(current.format(TIME_FORMAT))
		//console.log(date, " on Start")

		if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
			
			$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = current.format(DISP_FORMAT)
		}

		if (window.location.href.indexOf("mode=slideshow") != -1) {
			/* for(let i=0; i<randomSliderArray.length; i++) {
				if(document.getElementById(i) !== null) {
					document.getElementById(i).innerHTML = current.format(DISP_FORMAT)
				}
			} */
		} else {

			// Show it in edit mode
			if(current.format(DISP_FORMAT) === moment(new Date(date + " " + time)).format(DISP_FORMAT)) {
				//console.log("same date") 
			} else {
				//console.log("diff date")
				const getTimerDiv = setInterval(function() {
					//console.log("calling - ", _timerClick)
					if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
						clearInterval(getTimerDiv)
						if(_initEventTime != "") {
							timerClick()
							pulsateTime()
						}
					}
				}, 100)
				
			}
		}

		// Remove Previous timer
		//if(updateTimeTimer != undefined) {
		//	clearTimeout(updateTimeTimer)
		//}
		//updateTimeTimer = setTimeout(setUpDateTime, (60*1000));
		//setUpDateTime()
		setTimeout(setUpDateTime, (60*1000));
	}
	///////////////////////////////////////////////////

	function setUpDateTime() {
		//console.log(" --- Called --- ")
		if (window.location.href.indexOf("mode=slideshow") != -1) {

			let currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML
			let resultDate = moment(currentTime, DISP_FORMAT);

			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				//$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = resultDate.add(1, 'minutes').format(DISP_FORMAT)
				$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = isToday ? moment(new Date()).format(DISP_FORMAT) : resultDate.add(1, 'minutes').format(DISP_FORMAT)
			}

			//console.log("Called time update")
			let updatedResultDate = moment($(".root")[0].getElementsByClassName('float-left')[0].innerHTML, DISP_FORMAT);
			let lookupDate = updatedResultDate.format(DATE_FORMAT)
			let lookupTime = updatedResultDate.format(ONLY_TIME_FORMAT)


			if(idleStatus == true) {
				//console.log(idleStatus, " Checking idle mode")
				getUpdatedDate(lookupDate, lookupTime)
			}

			// Remove Previous timer
			if(updateTimeTimer != undefined) {
				clearTimeout(updateTimeTimer)
			}
			updateTimeTimer = setTimeout(setUpDateTime, (60*1000));
			/* for(let i=0; i<randomSliderArray.length; i++) {
				if(document.getElementById(i) !== null) {
					document.getElementById(i).innerHTML = resultDate.add(1, 'minutes').format(DISP_FORMAT)
				}
			} */
		} else {
			let currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML
			let resultDate = moment(currentTime, DISP_FORMAT);

			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				//$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = resultDate.add(1, 'minutes').format(DISP_FORMAT)
				$(".root")[0].getElementsByClassName('float-left')[0].innerHTML = isToday ? moment(new Date()).format(DISP_FORMAT) : resultDate.add(1, 'minutes').format(DISP_FORMAT)
			}

			//console.log("Called time update")
			let updatedResultDate = moment($(".root")[0].getElementsByClassName('float-left')[0].innerHTML, DISP_FORMAT);
			let lookupDate = updatedResultDate.format(DATE_FORMAT)
			let lookupTime = updatedResultDate.format(ONLY_TIME_FORMAT)

			if(idleStatus == true) {
				//console.log(idleStatus, " Checking idle mode")
				getUpdatedDate(lookupDate, lookupTime)
			}

		//}
			// Remove Previous timer
			if(updateTimeTimer != undefined) {
				clearTimeout(updateTimeTimer)
			}
			//updateTimeTimer = setTimeout(setUpDateTime, (60*1000));
			//if(isToday) {
			//	updateTimeTimer = setTimeout(setUpDateTime, (1*1000));
			//} else {
			updateTimeTimer = setTimeout(setUpDateTime, (60*1000));
			//}
		}
	}

	function pulsateTime() {
		if(mPulsateTimer != undefined) {
			clearTimeout(mPulsateTimer)
		}

		
		// Enable disable button ( - + )
		//console.log(moment(new Date(date + " " + time), DISP_FORMAT).format(DISP_FORMAT), " ----- ", moment($(".root")[0].getElementsByClassName('float-left')[0].innerHTML, DISP_FORMAT).format(DISP_FORMAT))

		/* let filterDate = moment(new Date(date + " " + time), "MM/DD").format("MM/DD")
		let searchDate = moment($(".root")[0].getElementsByClassName('float-left')[0].innerHTML, "MM/DD").format("MM/DD")
		console.log(searchDate, " ---- ", filterDate)
		if (searchDate > filterDate) {
			console.log('date is today or in future');
		} else if (searchDate == filterDate) {
			console.log('date is in the present');
		} else {
			console.log('date is in the past');
		} */
		

		if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
			//let filterDate = moment(new Date(date + " " + time), DISP_FORMAT).format(DISP_FORMAT)
			let filterDate = current.format(ONLY_MD_FORMAT)
			let currentTime = $(".root")[0].getElementsByClassName('float-left')[0].innerHTML


			///////////////////////////////////////////////////////////////////////////
			// New Logic
			/* let resultDateMax = moment(currentTime, DISP_FORMAT).format(DISP_FORMAT);
			let resultDatePrev = moment(currentTime, DISP_FORMAT);
			let resultDate = moment(_initEventTime, DISP_FORMAT).format(DISP_FORMAT);
			let finalEventDate = moment(_lastEventTime, DISP_FORMAT)
			let minSearchDate = resultDatePrev.add(-30, 'minutes').format(DISP_FORMAT)
			let maxSearchDate = finalEventDate.add(-60, 'minutes').format(DISP_FORMAT) */


			///////////////////////////////////////////////////////////////////////////

			let cTime = moment(currentTime, ONLY_MD_FORMAT).format(ONLY_MD_FORMAT)
			let curTime = moment(currentTime, DISP_FORMAT)
			let _eventStartTime = moment(_initEventTime, ONLY_MD_FORMAT).format(ONLY_MD_FORMAT)
			let _eventInitStartTime = moment(_initEventTime, ONLY_MD_FORMAT)
			let _eventEndTime = moment(_lastEventTime, ONLY_MD_FORMAT)
			let _minStartTime = _eventInitStartTime.add(-30, 'minutes').format(ONLY_MD_FORMAT)
			let _maxStartTime = _eventEndTime.add(-90, 'minutes').format(ONLY_MD_FORMAT)

			//console.log(cTime, " cTime ", _eventStartTime, " END ", _eventEndTime)
			let compareTime = curTime.add(-30, 'minutes').format(ONLY_MD_FORMAT)
			//console.log(_minStartTime, " --- ", cTime, " ST ", _eventStartTime)
			//console.log(compareTime, " > ", _maxStartTime, " < ", _eventStartTime)

			//console.log("Pulsate - ", _timerClick)
			
			
			if(compareTime < _eventStartTime) {
				//console.log("Prev Time")
				if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 1
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 0.2
				} 
			} else if(compareTime > _maxStartTime) {
				//console.log("Outside range")
				if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 0.2
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 1
				}
			} else {
				//console.log("Inside the bloack")
				if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 1
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 1
				}
			}
		
			///////////////////////////////////////////////////////////////////////////
			//if(minSearchDate < resultDate) {
				//console.log("LESS")
				/* if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 1
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 0.2
				} */
			//} else if(resultDateMax > maxSearchDate) {
				//console.log(resultDateMax, " ---- ", maxSearchDate)
				//console.log("Greater")
				/* if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 0.2
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 1
				} */
			//} else {
				//console.log("BOTH")
				/* if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 1
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 1
				} */
			//}
			//////////////////////////////////////////////////////////////////////////////////////////////
			/* 
			let resultDatePrev = moment(currentTime, DISP_FORMAT);
			let resultDateMax = moment(currentTime, ONLY_MD_FORMAT).format(ONLY_MD_FORMAT);
			let minSearchDate = resultDatePrev.add(-30, 'minutes').format(DISP_FORMAT)

			//console.log(resultDate.format(DISP_FORMAT), " - ", minSearchDate)

			//let maxsearchDate = resultDateMax.add(1, 'day').format(ONLY_MD_FORMAT)
			//console.log(resultDate.add(-30, 'minutes').format(DISP_FORMAT), " RD")
			//console.log(resultDateMax, " --- ", filterDate)

			if(minSearchDate < filterDate) {
				//console.log('previous date - Hide Previous button')
				if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 1
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 0.2
				}
			} else if(resultDateMax > filterDate) {
				//console.log("outside search - Hide Next Button")
				if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 0.2
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 1
				}
			} else {
				//console.log("inside - Show both buttons")
				if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_plus')[0].style.opacity = 1
				}
				if($(".root")[0].getElementsByClassName('ak_card_minus')[0] != undefined) {
					$(".root")[0].getElementsByClassName('ak_card_minus')[0].style.opacity = 1
				}
			} */
			//////////////////////////////////////////////////////////////////////////////////////////////


			/* if(minsearchDate < filterDate) {
				console.log("previous date")
			} else if(maxsearchDate > filterDate) {
				console.log("date Passed")
			} else {
				console.log("inside")
			} */
			//, " ----- ", moment($(".root")[0].getElementsByClassName('float-left')[0], DISP_FORMAT).format(DISP_FORMAT)

			
			if($(".root")[0].getElementsByClassName('ak_card_plus')[0] != undefined) {
				if($(".root")[0].getElementsByClassName('ak_card_plus')[0].style.display == 'none') {return}
			}
			if($(".root")[0].getElementsByClassName('float-left')[0] != undefined) {
				if($(".root")[0].getElementsByClassName('float-left')[0].style.color == 'red') {
					$(".root")[0].getElementsByClassName('float-left')[0].style.color = '#222'
				} else {
					$(".root")[0].getElementsByClassName('float-left')[0].style.color = 'red'
				}
			}

			if (window.location.href.indexOf("mode=slideshow") != -1) {
				/* for(let i=0; i<randomSliderArray.length; i++) {
					if(document.getElementById(i) !== null) {
						//console.log(document.getElementById(i), " elements")
						if(document.getElementById(i).style.color == "red") {
							document.getElementById(i).style.color = "#222"
						} else {
							document.getElementById(i).style.color = "red"
						}
					}
				} */
			} 
		}

		mPulsateTimer = setTimeout(pulsateTime, (700));
	}

	var firstEvents = new Map();
	var moreLess = "More";
	$(".image_id").css("display", "block");

	if (window.location.href.indexOf("mode=slideshow") != -1) {

		document.body.classList.add('slideshow');
      	$.ajax({
        //url: apiurl,
		url: 'data.php',
		type:'POST',
		data:{'sheetId' : urlid, 'sheet' : sheet},
        cache: false,
        success: function (response) {

		//console.log(response, " >>> response")

        $(".image_id").css("display", "none");

        var todayArray = [];
        var todayArrayNext = [];
		sliderData = []

		/* var formatJSONString = response.replace(/'/g, '"').replace(/"s/g, "'s"); 
		var dataResponse = JSON.parse(formatJSONString)*/
		//console.log(b)
		// New Formatting
		/* var mResponseDQ = response.replace(/"/g, "dqo")
		var mResponseSQ = mResponseDQ.replace(/'/g, '"')
		var mResponseFS = mResponseSQ.replace(/\\"/g, "'")
		var mResponseSQS = mResponseFS.replace(/"s/g, "'s")
		var mResponseUDQ = mResponseSQS.replace(/: dqo/g, ':"')
		var mResponseUDQQ = mResponseUDQ.replace(/dqo'/g, '",')
		var mResponseUDQQC = mResponseUDQQ.replace(/ dqo,/g, '",')
		var mResponseFinal = mResponseUDQQC.replace(/dqo, "/g, '", "')
		var dataResponse = JSON.parse(mResponseFinal) */

		/* var mResponseDQ = response.replace(/"/g, "dqo")
		var mResponseDDQ = mResponseDQ.replace(/: dqo/g, ": 'dqo")
		var mResponseDDQE = mResponseDDQ.replace(/dqo,/g, "dqo',")
		const regex = /('(?=(,\s*')))|('(?=:))|((?<=([:,]\s*))')|((?<={)')|('(?=}))/g;
		let replaceResponse = mResponseDDQE.replace(regex, '"'); */


		// Response JSON Formatting to accept all chars
		var mResponseSC = response.replace(/�/g, "")
		var mResponseDQ = mResponseSC.replace(/"/g, "dqo")
		var mResponseDDQ = mResponseDQ.replace(/: dqo/g, ": 'dqo")
		var mResponseDDQE = mResponseDDQ.replace(/dqo,/g, "dqo',")
		
		//const regex = /('(?=(,\s*')))|('(?=:))|((?<=([:,]\s*))')|((?<={)')|('(?=}))/g;
		//const regex = /('(?=(,\s')))|('(?=:))|((?<=([:,]\s))')|((?<={)')|('(?=}))/g;


		//const regex = /('(?=(,\s*')))|('(?=:))|((?:([:,]\s*))')|((?:{)')|('(?=}))/g;

		const regex = /('(?=(,\s*')))|('(?=:))|((?=([:,]\s*))')|((?={)')|('(?=}))/g;
		let replaceResponseRegX = mResponseDDQE.replace(regex, '"').replace(/{'/g, '{"').replace(/: '/g, ': "').replace(/, '/g, ', "');
		
		//let replaceResponseRegX = mResponseDDQE.replace(regex, '"');
		let replaceResponse = replaceResponseRegX.replace(/\\'/g, "'");
		var dataResponse = JSON.parse(replaceResponse) 


		/////////////////////////////////////////////////////////////////////////////////////
		if(moment(new Date(iDate)).format(DATE_FORMAT) == moment(new Date()).format(DATE_FORMAT)) {
			current = moment(new Date());
			//isToday = true
		} else if(iDate != null) {
			current = moment(new Date(iDate));
			//isToday = false
		} else {
			current = moment(new Date());
			//isToday = true
		}
		// To check for next day
		nDate = new Date(current)
		nDate.setDate(nDate.getDate() + 1)
		nDate.setHours(0,0,0,0)
		//console.log(nDate)
		/////////////////////////////////////////////////////////////////////////////////////



		  //sliderData.push(response)
		  sliderData.push(dataResponse)

          dataResponse.forEach((q) => {
            let data = {
              code: q.Code.toString().replace(/dqo/g, '"'),
              name: q.Event.toString().replace(/dqo/g, '"'),
              speakers: q.Presenters.toString().replace(/dqo/g, '"'),
              desc: q.Description.toString().replace(/dqo/g, '"'),
              start: q.Start,
              end: q.End,
              info: q.Info.toString().replace(/dqo/g, '"'),
              location: Number.isFinite((q.Location)) == false ? q.Location : ("SCHEDULED - " + q.Location),
              capacity: q.Capacity.toString().replace(/dqo/g, '"'),
              count: q.Count,
              images: q.Image.toString().replace(/dqo/g, '"'),
              status: q.Status.toString().replace(/dqo/g, '"'),
              link1: q.Link1.toString().replace(/dqo/g, '"'),
              url1: q.Url1.toString().replace(/dqo/g, '"'),
              link2: q.Link2.toString().replace(/dqo/g, '"'),
              url2: q.Url2.toString().replace(/dqo/g, '"'),
              platform: q.Platform.toString().replace(/dqo/g, '"'),
              accessInfo: q.AccessInfo.toString().replace(/dqo/g, '"'),
			  start1: q.Start1,
			  end1: q.End1,
            };

            if (data.images.includes("https://drive.google.com")) {
              imgid = data.images.substr(
                data.images.lastIndexOf("id="),
                data.images.length - 1
              );
              data.images = "https://drive.google.com/uc?export=view&" + imgid;
            }

            /* if (data.location && data.name && data.start && data.end) {
              let date = new Date(data.start);
              let dateKey = moment(date).format(DATE_FORMAT);

              if (
                moment(new Date(data.end)) > current &&
                dateKey == current.format(DATE_FORMAT)
              ) {
                // This event is for the given day, and is either happening now, or later in the day
                todayArray.push(data);
              } */

			  if (data.location && data.name && (data.start || data.start1 || data.start2 || data.start3 || data.start4) && (data.end || data.end1 || data.end2 || data.end3 || data.end4)) {
				
				//////////////////////////////////////////////////////////////////////////////////
				// For Start 
				let date = new Date(data.start);
				let dateKey = moment(date).format(DATE_FORMAT);
			   
				// For Start1
				let date1 = new Date(data.start1);
				let dateKey1 = moment(date1).format(DATE_FORMAT);
				
				// For Start2
				let date2 = new Date(data.start2);
				let dateKey2 = moment(date2).format(DATE_FORMAT);

				// For Start3
				let date3 = new Date(data.start3);
				let dateKey3 = moment(date3).format(DATE_FORMAT);

				// For Start3
				let date4 = new Date(data.start4);
				let dateKey4 = moment(date4).format(DATE_FORMAT);
				//////////////////////////////////////////////////////////////////////////////////

				// For Start
				if (
				  moment(new Date(data.end)) > current &&
				  dateKey == current.format(DATE_FORMAT)
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start1
				if (
				  moment(new Date(data.end1)) > current &&
				  dateKey1 == current.format(DATE_FORMAT) && moment(new Date(data.start1)) >= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start2
				if (
				  moment(new Date(data.end2)) > current &&
				  dateKey2 == current.format(DATE_FORMAT) && moment(new Date(data.start2)) >= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start3
				if (
				  moment(new Date(data.end3)) > current &&
				  dateKey3 == current.format(DATE_FORMAT) && moment(new Date(data.start3)) <= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				} else

				// For Start4
				if (
				  moment(new Date(data.end4)) > current &&
				  dateKey4 == current.format(DATE_FORMAT) && moment(new Date(data.start4)) <= current
				) {
				  // This event is for the given day, and is either happening now, or later in the day
				  todayArray.push(data);
				}
				//////////////////////////////////////////////////////////////////////////////////




              // Store the first events of the day to create a summary calendar link
              if (firstEvents.has(dateKey)) {
                if (date < firstEvents[dateKey]) {
                  firstEvents.set(dateKey, date);
                }
              } else {
                firstEvents.set(dateKey, date);
              }
            }
          });

          if (room != null) {
            var todayArrayNext = todayArray.filter(
              (item) => item.location.toLowerCase().indexOf(room) > -1
            );
          }

          var todayArrayNext = room != null ? todayArrayNext : todayArray;
          // var sortedArray  = todayArrayNext.sort((a,b) => new Date(a.start) - new Date(b.start));

          /* var sortedArray = todayArrayNext.sort(function (a, b) {
            const aLoc = locSorting.indexOf(a.location);
            const bLoc = locSorting.indexOf(b.location);

            if (aLoc == -1 && bLoc == -1) {
              return new Date(a.start) - new Date(b.start);
            }
            if (aLoc == -1) {
              return 1;
            }
            if (bLoc == -1) {
              return -1;
            }
            return new Date(a.start) - new Date(b.start);
          }); */
		  ////////////////////////////////////////////////////////////////////////////////////////////////////////////
		  function getSortedArr(todayArrayNext) {
				return [...todayArrayNext].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					if (aLoc == -1 && bLoc == -1) {
						return new Date(a.start) - new Date(b.start)
					}
					if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					}
					
					return new Date(a.start) - new Date(b.start)
				})
			}
			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			// Sort Based on Start 1
			function getSortedArrStart1(sortStart) {
				return [...sortStart].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					if (aLoc == -1 && bLoc == -1) {
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start1 != "" && new Date(b.start1) >= new Date(current) && new Date(b.start1) < nDate) {
								//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start1)
							} 
						}
					}
					if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					}
					/* if(b.start2 != "" && new Date(b.start2) >= new Date(selectedDate)) {
						return new Date(a.start) - new Date(b.start2)
					} */ 
					if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
						return new Date(b.start) - new Date(a.start)
					} else {
						if(b.start1 != "" && new Date(b.start1) >= new Date(current) && new Date(b.start1) < nDate) {
							//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
							return new Date(a.start) - new Date(b.start1)
						} 
					}
				})
			}

			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			// Sort Based on Start 2
			function getSortedArrStart2(sortStart2) {
				return [...sortStart2].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					if (aLoc == -1 && bLoc == -1) {
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start2 != "" && new Date(b.start2) >= new Date(current) && new Date(b.start2) < nDate) {
								//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start2)
							}
						}
					}
					if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					}
					/* if(b.start1 != '' && new Date(b.start1) >= new Date(selectedDate)) {
						return new Date(a.start) - new Date(b.start1)
					} */
					if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
						return new Date(b.start) - new Date(a.start)
					} else {
						if(b.start2 != "" && new Date(b.start2) >= new Date(current) && new Date(b.Start2) < nDate) {
							//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
							return new Date(a.start) - new Date(b.start2)
						}
					}
				})
			}

			////////////////////////////////////////////////////////////////////////////////////////////////////////////
			// Sorting Order
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////
			// Previous
			/* let sortStart = getSortedArr(todayArrayNext)
			let sortStart2 = getSortedArrStart1(sortStart)
			let sortedArray = getSortedArrStart2(sortStart2) */
			// New
			// Clear All Containers
			outputInit = [];
			output1 = [];
			output1_1 = [];
			output1_2 = [];
			output2 = [];
			output2_1 = [];
			output2_2 = [];
			output3 = [];
			// Reassing Values to those containers
			let mFormat = doFormat(todayArrayNext, nDate)
			let mFormat1 = doFormat1(mFormat, nDate)
			let mFormat2 = doFormat2(mFormat1, nDate)
			let mFormat1_1 = doFormat3(mFormat2, nDate)
			let mFormat2_1 = doFormat1_1(mFormat1_1, nDate)
			let mFormat2_2 = doFormat2_1(mFormat2_1, nDate)
			let sortedArray = doFormat2_2(mFormat2_2, nDate)

			//let sortedArray = doFormat(sortedArray1, nDate)
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////////////////////////////////

          var slideObjArr = [];

          var output = sortedArray.reduce(function (result, value) {
            var location = value.location;
            result[location] = result[location] || [];
            result[location].push({
              code: value.code,
              name: value.name,
              speakers: value.speakers,
              desc: value.desc,
              start: value.start,
              end: value.end,
              info: value.info,
              location: value.location,
              capacity: value.capacity,
              images: value.images,
              count: value.count,
              status: value.status,
              link1: value.link1,
              url1: value.url1,
              link2: value.link2,
              url2: value.url2,
              platform: value.platform,
              accessInfo: value.accessInfo,
			  start1: value.start1,
              end1: value.end1,
            });
            return result;
          }, {});

          if (
            (Object.keys(output).length === 0 &&
              output.constructor === Object) == false
          ) {
            var counter = "";

            let entries = Object.entries(output);

            for (let [index, [key, value]] of entries.entries()) {
              slideObjArr.push(value[0]);

              //console.log("index:"+index  + " Key:"+ key + " value:"+ value)
            }
            // console.log(slideObjArr);
            randomSliderArray = slideObjArr.sort(() => Math.random() - 0.5);
            

            let shownUpnextCount = 0;
            let lastKey = "";

            //$(".root").append(`${showCalLinks()}`);
			function truncateString(str, num) {
			  // If the length of str is less than or equal to num
			  // just return str--don't truncate it.
			  if (str.length <= num) {
				return str
			  }
			  // Return str truncated with '...' concatenated to the end of str.
			  return str.slice(0, num) + '...'
			}

            // add image slider
            $(".root").append(
              `
			  <!--div class="slide_item">
			  	<div class="top_head" onclick="ResetTimerClick()">
					<div class="time" style="margin-left:0px" id=`+0+`>${moment(new Date()).format(DISP_FORMAT)}</div>
				</div-->
                    <div class="mt-2 image_slider" >
						
                      ${randomSliderArray
                        .map(function (galleryValue, index) {

							//////////////////////////////////////
							let isHappeningNowPresent = false;
							let shownHappeningNowCount = 0;
							let visibleCount = 0;


							let isHappeningNow = 0
							if(current < moment(new Date(galleryValue.end))) {
								isHappeningNow =
									current >= moment(new Date(galleryValue.start)) &&
									current < moment(new Date(galleryValue.end));
							} else if(current < moment(new Date(galleryValue.end1))) {
								isHappeningNow =
									current >= moment(new Date(galleryValue.start1)) &&
									current < moment(new Date(galleryValue.end1));
							} else if(current < moment(new Date(galleryValue.end2))) {
								isHappeningNow =
									current >= moment(new Date(galleryValue.start2)) &&
									current < moment(new Date(galleryValue.end2));
							} else if(current < moment(new Date(galleryValue.end3))) {
								isHappeningNow =
									current >= moment(new Date(galleryValue.start3)) &&
									current < moment(new Date(galleryValue.end3));
							} else if(current < moment(new Date(galleryValue.end4))) {
								isHappeningNow =
									current >= moment(new Date(galleryValue.start4)) &&
									current < moment(new Date(galleryValue.end4));
							}

							let isSameDay = 0
							if(current < moment(new Date(galleryValue.end))) {
								isSameDay =
									current.format(DATE_FORMAT) <=
									moment(new Date(galleryValue.start)).format(DATE_FORMAT);
							} else if(current < moment(new Date(galleryValue.end1))) {
								isSameDay =
									current.format(DATE_FORMAT) <=
									moment(new Date(galleryValue.start1)).format(DATE_FORMAT);
							} else if(current < moment(new Date(galleryValue.end2))) {
								isSameDay =
									current.format(DATE_FORMAT) <=
									moment(new Date(galleryValue.start2)).format(DATE_FORMAT);
							} else if(current < moment(new Date(galleryValue.end3))) {
								isSameDay =
									current.format(DATE_FORMAT) <=
									moment(new Date(galleryValue.start3)).format(DATE_FORMAT);
							} else if(current < moment(new Date(galleryValue.end4))) {
								isSameDay =
									current.format(DATE_FORMAT) <=
									moment(new Date(galleryValue.start4)).format(DATE_FORMAT);
							}

							let isUpNext = 0
							if(current < moment(new Date(galleryValue.end))) {
								isUpNext =
									moment(new Date(galleryValue.start)) >= current;
							} else if(current < moment(new Date(galleryValue.end1))) {
								isUpNext =
									moment(new Date(galleryValue.start1)) >= current;
							} else if(current < moment(new Date(galleryValue.end2))) {
								isUpNext =
									moment(new Date(galleryValue.start2)) >= current;
							} else if(current < moment(new Date(galleryValue.end3))) {
								isUpNext =
									moment(new Date(galleryValue.start3)) >= current;
							} else if(current < moment(new Date(galleryValue.end4))) {
								isUpNext =
									moment(new Date(galleryValue.start4)) >= current;
							}

							let isPassed = 0
							if(current < moment(new Date(galleryValue.end))) {
								isPassed =
									moment(new Date(galleryValue.end)) <= current;
							} else if(current < moment(new Date(galleryValue.end1))) {
								isPassed =
									moment(new Date(galleryValue.end1)) <= current;
							} else if(current < moment(new Date(galleryValue.end2))) {
								isPassed =
									moment(new Date(galleryValue.end2)) <= current;
							} else if(current < moment(new Date(galleryValue.end3))) {
								isPassed =
									moment(new Date(galleryValue.end3)) <= current;
							} else if(current < moment(new Date(galleryValue.end4))) {
								isPassed =
									moment(new Date(galleryValue.end4)) <= current;
							}

							let hideEvent = index > shownHappeningNowCount;
							let showEvent =
							isHappeningNow || (isUpNext && !hideEvent);
							if (showEvent) {
							visibleCount++;
							}

							if (lastKey != index) {
							shownUpnextCount = 0;
							shownHappeningNowCount = 0;
							isHappeningNowPresent = false;
							}
							if (!isHappeningNow && isSameDay && isUpNext) {
							shownUpnextCount += 1;
							}
							if (isHappeningNow && shownUpnextCount == 0) {
							isHappeningNowPresent = true;
							shownHappeningNowCount += 1;
							}
							///////////////////////////////////////

                          return `
                          ${
                            galleryValue.images
                              ? `
							  <div class="slide_item">
								<div class="top_head" onclick="ResetTimerClick()">
									<!--div class="card-header ak_card_timer">
										<img id="editTimer" src="images/ear_icon_time.png" width="70px" height="70px" alt="" onclick="timerClick()" />
									</div>
									<div class="card-header ak_card_minus">
										<img id="editTimer" src="images/ear_icon_minus.png" width="70px" height="70px" alt="" onclick="timerMinusClick()" />
									</div>

									<div class="card-header ak_card_plus">
										<img id="editTimer" src="images/ear_icon_plus.png" width="70px" height="70px" alt="" onclick="timerPlusClick()" />
									</div-->
									
									<div class="time" style="margin-left:0px" id=`+index+`>${upDateSlideTime(index)/* moment(new Date()).format(DISP_FORMAT) *//* current.format(DISP_FORMAT) */}</div>
									<!--div class="title">${galleryValue.location}</div-->
									${
										isHappeningNow &&
										shownHappeningNowCount < 2 &&
										isSameDay
											? `<h6 class="card-title ak_card_subtitle mt-3" id=happenText_`+index+`>HAPPENING NOW</h5>`
											: ``
										}
										${
										!isHappeningNow &&
										isHappeningNowPresent &&
										isUpNext &&
										isSameDay &&
										shownUpnextCount == 1
											? `<h6 class="card-title ak_card_subtitle mt-3" id=upText_`+index+`>UP NEXT</h5>`
											: ``
									}
								</div>

								<div class="expect_ratio_images">
								  <img src="${
									galleryValue.images
								  }" class="ak_img_detail">
								</div>
								<div class="card-index">
								<span class="card-text ak_room_title">${
                                        galleryValue.code
                                      } - ${galleryValue.name}</span>
                                      <span>${showStatus(galleryValue)}</span>

                                      <br>

                                      <b class="speakers" style="color: black !important;">${
                                        galleryValue.speakers
                                      }</b><br>
                                      <div class="ak_room_descp mt-3">

                                        <span class="d-inline-block ${
                                          !galleryValue.images ? ` ` : `nay_des`
                                        }">${truncateString(galleryValue.desc, 180)}</span>
                                      </div>

									</div>
									<div class="ftr-info-text">
									<div class="leftInfo">
									  <div class="info float-left  w-100">${
										/* moment(galleryValue.start, DISP_FORMAT).format(DISP_FORMAT) */
										galleryValue.info
									  }</div>
									  <span class="float-left w-100 ak_date">${moment(
										new Date(galleryValue.start)
									  ).format("dddd hh:mm A")} - ${moment(
										  new Date(galleryValue.end)
										).format("hh:mm A")}</span>
										<span class="info float-left  w-100">${galleryValue.location}</span>
										</div>
										<div class="barcode">
											<div id="qrcode${`_${index}`}"></div>
										</div>
									</div>
									
							</div>
                            `
                              : `

                            `
                          }
                          `;
                        })
                        .join("")}
                  </div>
                    `
            );

			// Creating QR Code
			randomSliderArray.map(function (galleryValue, index) {
				let regexp = /android|iphone|kindle|ipad/i;
      		   let isMobileDevice = regexp.test(navigator.userAgent);
				// to check screen landscape or potrait
				var mql = window.matchMedia("(orientation: portrait)");

				// If there are matches, we're in portrait
				if(mql.matches && !isMobileDevice) {
					// Portrait orientation
					var width = height = 150;
				} else {
					// Landscape orientation
					var width = height = 100;
				}
				//console.log(width, " width ", document.getElementById('qrcode_' + index))
				if(document.getElementById('qrcode_' + index) != null) {
					const qrcode = new QRCode(document.getElementById('qrcode_' + index), {
					text: String(galleryValue.url1),
					width: width,
					height: height,
					colorDark : '#000',
					colorLight : '#fff',
					correctLevel : QRCode.CorrectLevel.H
					});
				}
			})

            $(".image_slider").slick({
              dots: false,
              arrows: true,
              infinite: true,
              speed:400,
			  autoplaySpeed: 10000,
              autoplay: true,
              slidesToShow: 1,
			  adaptiveHeight:true,
              slidesToScroll: 1
            });

			function upDateSlideTime(_index) {
				let mTimerTimeout = setTimeout(updateTimerTimer, 10)
				function updateTimerTimer() {
					clearTimeout(mTimerTimeout)
					document.getElementById(_index).innerHTML = moment(new Date()).format(DISP_FORMAT)


					////////////////////////////////////////////////////////////////////////////////////
					/* 
					// Setting HAPPENNING NOW / UP NEXT SLIDES
					let mCurrent = moment(new Date())
					//console.log(document.getElementById("happenText_" + _index).innerHTML, " HAPP")
					//console.log(randomSliderArray[_index].start, " ---- ", randomSliderArray[_index].end)
					let isHappeningNow = 0
					if(mCurrent < moment(new Date(randomSliderArray[_index].end))) {
						isHappeningNow =
						mCurrent >= moment(new Date(randomSliderArray[_index].start)) &&
						mCurrent < moment(new Date(randomSliderArray[_index].end));
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end1))) {
						isHappeningNow =
						mCurrent >= moment(new Date(randomSliderArray[_index].start1)) &&
						mCurrent < moment(new Date(randomSliderArray[_index].end1));
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end2))) {
						isHappeningNow =
						mCurrent >= moment(new Date(randomSliderArray[_index].start2)) &&
						mCurrent < moment(new Date(randomSliderArray[_index].end2));
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end3))) {
						isHappeningNow =
						mCurrent >= moment(new Date(randomSliderArray[_index].start3)) &&
						mCurrent < moment(new Date(randomSliderArray[_index].end3));
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end4))) {
						isHappeningNow =
						mCurrent >= moment(new Date(randomSliderArray[_index].start4)) &&
						mCurrent < moment(new Date(randomSliderArray[_index].end4));
					}

					let isSameDay = 0
					if(mCurrent < moment(new Date(randomSliderArray[_index].end))) {
						isSameDay =
						mCurrent.format(DATE_FORMAT) <=
							moment(new Date(randomSliderArray[_index].start)).format(DATE_FORMAT);
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end1))) {
						isSameDay =
						mCurrent.format(DATE_FORMAT) <=
							moment(new Date(randomSliderArray[_index].start1)).format(DATE_FORMAT);
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end2))) {
						isSameDay =
						mCurrent.format(DATE_FORMAT) <=
							moment(new Date(randomSliderArray[_index].start2)).format(DATE_FORMAT);
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end3))) {
						isSameDay =
						mCurrent.format(DATE_FORMAT) <=
							moment(new Date(randomSliderArray[_index].start3)).format(DATE_FORMAT);
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end4))) {
						isSameDay =
						mCurrent.format(DATE_FORMAT) <=
							moment(new Date(randomSliderArray[_index].start4)).format(DATE_FORMAT);
					}

					let isUpNext = 0
					if(mCurrent < moment(new Date(randomSliderArray[_index].end))) {
						isUpNext =
							moment(new Date(randomSliderArray[_index].start)) >= mCurrent;
					} else if(current < moment(new Date(randomSliderArray[_index].end1))) {
						isUpNext =
							moment(new Date(randomSliderArray[_index].start1)) >= current;
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end2))) {
						isUpNext =
							moment(new Date(randomSliderArray[_index].start2)) >= mCurrent;
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end3))) {
						isUpNext =
							moment(new Date(randomSliderArray[_index].start3)) >= mCurrent;
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end4))) {
						isUpNext =
							moment(new Date(randomSliderArray[_index].start4)) >= mCurrent;
					}

					let isPassed = 0
					if(mCurrent < moment(new Date(randomSliderArray[_index].end))) {
						isPassed =
							moment(new Date(randomSliderArray[_index].end)) <= mCurrent;
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end1))) {
						isPassed =
							moment(new Date(randomSliderArray[_index].end1)) <= mCurrent;
					} else if(mCurrent < moment(new Date(randomSliderArray.end2))) {
						isPassed =
							moment(new Date(randomSliderArray[_index].end2)) <= mCurrent;
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end3))) {
						isPassed =
							moment(new Date(randomSliderArray[_index].end3)) <= mCurrent;
					} else if(mCurrent < moment(new Date(randomSliderArray[_index].end4))) {
						isPassed =
							moment(new Date(randomSliderArray[_index].end4)) <= mCurrent;
					} */

					{


						//console.log(mCurrent, " ::: ", moment(new Date(randomSliderArray[_index].end)))

						/* console.log(isPassed, " --- ", _index)
						if(isPassed != false) {
							document.getElementById('happenText_'+_index).innerHTML = "PASSED"
						} */

						/* if(isPassed) {
							console.log(_index, " PASSED")
						} else {
							console.log(_index, " STILL")
						} */


						/* (isHappeningNow && isSameDay)
							? document.getElementById('happenText_'+_index).innerHTML = "HAPPENING NOW" : document.getElementById('happenText_'+_index).innerHTML = ""
						
						} */
						/* {
						!isHappeningNow &&
						isHappeningNowPresent &&
						isUpNext &&
						isSameDay &&
						shownUpnextCount == 1
							? document.getElementById('upText') != null ? document.getElementById('upText').innerHTML = "UP NEXT" : ""
						
					} */
				}
					/////////////////////////////////////////////////////////////////////////////////////
					mTimerTimeout = setTimeout(updateTimerTimer, (1000))
				}
			}

            for (let [index, [key, value]] of entries.entries()) {
              color = colors[index % colors.length];
              let button1 = value[0].url1
                ? `
                    <a href=${`${value[0].url1}`} target="_blank">
                      <button type="button" class="btn btn-outline-dark float-right">${
                        value[0].link1
                      }</button>
                    </a>`
                : "";

              let button2 = value[0].url2
                ? `
                    <a href=${`${value[0].url2}`} target="_blank">
                      <button type="button" class="btn btn-outline-dark float-right">${
                        value[0].link2
                      }</button>
                    </a>`
                : "";

              let platform = value[0].platform
                ? `
                      <div class="tabletop-sim float-right">${value[0].platform} | ${value[0].accessInfo}</div>
                    `
                : "";

              let isHappeningNowPresent = false;
              let shownHappeningNowCount = 0;
              let visibleCount = 0;

            }
          } else {
            //$(".root").append(`${showCalLinks()}`);
            $(".root").append(
              ` <br><br><br>
                  <h1 class="text-center">NO EVENTS TODAY</h1>
      <div class="text-center">But you can find events for the following dates:</div>
      <div class="text-center">${showDateLinks()}</div>
                `
            );
          }

          $(".active").click(function () {
            var word = $(this).attr("class");

            var lastword = word.replace("active", "");

            var str = lastword.replace(/\s/g, "");

            if ($.trim($("." + str).text()) === "MORE") {
              $("." + str).text("LESS");
            } else {
              $("." + str).text("MORE");
            }

            $(`.hidden_card_${str}`).slideToggle();
          });
        },
        error: function (params) {
          $(".image_id").css("display", "none");

          $(".root").append(
            `
              <div >
                <figure>
                  <img src="http://www.earshot.chat/wp-content/uploads/2021/01/banner-1.jpg"/>
                </figure>
                <figure>
                  <img class="offline-icon" src="http://www.earshot.chat/wp-content/uploads/2021/01/earshot-logo-02.png"/>
                </figure>

                <h1 style="font-size: 19px; text-align: center; padding: 10px; margin-top: 0px;">event scheduling for classrooms, conventions, and cocktails</h1>
                <p style="text-align: center;">Copyright © 2021, Neuronic LLC.</p>
              </div>


            `
          );
        },

      });
	} // Slideshow Mode ends here
	else {
		//console.log(sheet, " -- sheet--- ", urlid)
		  $.ajax({
			//url: apiurl,
			url: 'data.php',
            type:'POST',
            data:{'sheetId' : urlid, 'sheet' : sheet},
			cache: false,
			success: function (response) {
			  //console.log(response, " >>>>> response")
				$(".image_id").css("display", "none");

				var todayArray = [];
				var todayArrayNext = [];

				var mResponseSC = response.replace(/�/g, "")
				var mResponseDQ = mResponseSC.replace(/"/g, "dqo")
				var mResponseDDQ = mResponseDQ.replace(/: dqo/g, ": 'dqo")
				var mResponseDDQE = mResponseDDQ.replace(/dqo,/g, "dqo',")

				//const regex = /('(?=(,\s*')))|('(?=:))|((?<=([:,]\s*))')|((?<={)')|('(?=}))/g;
				//const regex = /('(?=(,\s')))|('(?=:))|((?<=([:,]\s))')|((?<={)')|('(?=}))/g;
				//const regex = /('(?=(,\s*')))|('(?=:))|((?<=([:,]\s*))')|((?<={)')|('(?=}))/g;

				// Remove LookBehind operator to support for safari
				const regex = /('(?=(,\s*')))|('(?=:))|((?=([:,]\s*))')|((?={)')|('(?=}))/g;
				let replaceResponseRegX = mResponseDDQE.replace(regex, '"').replace(/{'/g, '{"').replace(/: '/g, ': "').replace(/, '/g, ', "');
				let replaceResponse = replaceResponseRegX.replace(/\\'/g, "'");
			//console.log(mResponseDDQE, " RES")
			//return
			

			//console.log(response)
			//return
			
			/* strData = JSON.parse(str);
			console.log(strData) */
			//////////////////////////////////////////////////////

			/* let jsString = ''
			response.match(/:.*"(.*)"/gi).forEach(function(element){
				var filtered = element.replace(/(^:\s*"|"(,)?$)/gi, '').trim();
				jsString = jsString.replace(filtered, filtered.replace(/(\\*)\"/gi, "\\\""));
				console.log(jsString, " jsonStr")
			}); */

			//console.log(response.replace(/(^:\s*"|"(,)?$)/gi, '').replace(/(\\*)\"/gi, "'dquo").replace(/dquo,/gi, ",").replace(/: 'dquo/gi, ": '"))

			//console.log(response.replace(/"/gi, "dqo").replace(/'/g, '"'))



			//////////////////////////////////////////////////////

			//return

			/* function replacer(key, value) {
  				console.log(typeof value);
				return value;
				}

			let userStrReplacer = JSON.parse(JSON.stringify(response, replacer)); */

				/* 
			  //console.log(response, " in response")
			  //var data = JSON.parse(response)
			  //console.log(response, " response")
			  //return
			  //var b = response.replace(/'/g, '"').replace(/"s/g, "'s").split(sheet)[1];
			  // Previous Formatting
			  //var formatJSONString = response.replace(/'/g, '"').replace(/"s/g, "'s");
				 */

				 // Formatting
			  // New Formatting // �
			  /* var mResponseSSQ = response.replace(/�/g, "")
			  var mResponseDQ = mResponseSSQ.replace(/"/g, "dqo")
			  var mResponseSQ = mResponseDQ.replace(/'/g, '"')
			  var mResponseFS = mResponseSQ.replace(/\\"/g, "'")
			  var mResponseSQS = mResponseFS.replace(/"s/g, "'s")


				var mResponseSQT = mResponseSQS.replace(/"t/g, "'t")
				var mResponseSQO = mResponseSQT.replace(/O"/g, "O'")
				var mResponseSQW = mResponseSQO.replace(/"ll/g, "'ll")
				var mResponseSQV = mResponseSQW.replace(/"ve/g, "'ve")
				var mResponseD = mResponseSQV.replace(/"d/g, "'d")


			  var mResponseUDQ = mResponseD.replace(/: dqo/g, ':"')
			  var mResponseUDQQ = mResponseUDQ.replace(/dqo'/g, '",')
			  var mResponseUDQQC = mResponseUDQQ.replace(/ dqo,/g, '",')
			  // More Formatting


			  var mResponseFinal = mResponseUDQQC.replace(/dqo, "/g, '", "') */

			  /////////////////////////////////////////////////////////////////////////////////////
			  // For Testing REMOVE ONCE DONE
			  //console.log(moment(new Date(iDate)).format(DATE_FORMAT), " --- ", moment(new Date()).format(DATE_FORMAT))
			  
			  if(moment(new Date(iDate)).format(DATE_FORMAT) == moment(new Date()).format(DATE_FORMAT)) {
				//console.log("1")
				current = moment(new Date());
			  	isToday = true
			  } else if(iDate != null && iDate != "") {
				//console.log("2 - ", iDate)
				current = moment(new Date(iDate));
			  	isToday = false
			  } else {
				//console.log("3")
				current = moment(new Date());
			  	isToday = true
			  }

			  //console.log(current.format(DISP_FORMAT))
			   /////////////////////////////////////////////////////////////////////////////////////

			   // To check for next day
				nDate = new Date(current)
				nDate.setDate(nDate.getDate() + 1)
				nDate.setHours(0,0,0,0)
				//console.log(nDate)
			  /////////////////////////////////////////////////////////////////////////////////////

			  //var dataResponse = JSON.parse(formatJSONString)
			  /* var t = response.replace(/^\w\s/g, '"');
			  console.log(Array.isArray(t)) */

			  //var dataResponse = JSON.parse(mResponseFinal)
			  var dataResponse = JSON.parse(replaceResponse)

			  //console.log(dataResponse, " DR")
			  
			  
			  sliderData = []
			  //sliderData.push(response)
			  sliderData.push(dataResponse)

			  

			  dataResponse.forEach((q) => {
				let data = {
				  code: q.Code.toString().replace(/dqo/g, '"'),
				  name: q.Event.toString().replace(/dqo/g, '"'),
				  speakers: q.Presenters.toString().replace(/dqo/g, '"'),
				  desc: q.Description.toString().replace(/dqo/g, '"'),
				  start: q.Start,
				  end: q.End,
				  info: q.Info.toString().replace(/dqo/g, '"'),
				  location: Number.isFinite((q.Location)) == false ? q.Location : ("SCHEDULED - " + q.Location),
				  capacity: q.Capacity.toString().replace(/dqo/g, '"'),
				  count: q.Count,
				  images: q.Image.toString().replace(/dqo/g, '"'),
				  status: q.Status.toString().replace(/dqo/g, '"'),
				  link1: q.Link1.toString().replace(/dqo/g, '"'),
				  url1: q.Url1.toString().replace(/dqo/g, '"'),
				  link2: q.Link2.toString().replace(/dqo/g, '"'),
				  url2: q.Url2.toString().replace(/dqo/g, '"'),
				  platform: q.Platform.toString().replace(/dqo/g, '"'),
				  accessInfo: q.AccessInfo.toString().replace(/dqo/g, '"'),
				  start1: q.Start1,
				  end1: q.End1,
				  start2: q.Start2,
				  end2: q.End2,
				  start3: q.Start3,
				  end3: q.End3,
				  start4: q.Start4,
				  end4: q.End4,
				};

				/* 
					//console.log(data, " DATA")
					//return
					//console.log(data.url1);
					//console.log("URL " + data.url1.indexOf("http"));
					// console.log("## " + data.images);
					// console.log("## " + data.images.lastIndexOf("id="));
					//console.log(
					// data.images.substr(
					// data.images.lastIndexOf("id="),
					// data.images.length - 1
					//)
					// );
 				*/

				if (data.images.includes("https://drive.google.com")) {
				  imgid = data.images.substr(
					data.images.lastIndexOf("id="),
					data.images.length - 1
				  );
				  data.images = "https://drive.google.com/uc?export=view&" + imgid;
				}

				// console.log("AKHM >> " + data.images);
				// Filter the date based on current day
				if (data.location && data.name && (data.start || data.start1 || data.start2 || data.start3 || data.start4) && (data.end || data.end1 || data.end2 || data.end3 || data.end4)) {
				
				  //////////////////////////////////////////////////////////////////////////////////
				  // For Start 
				  let date = new Date(data.start);
				  let dateKey = moment(date).format(DATE_FORMAT);
				 
				  // For Start1
				  let date1 = new Date(data.start1);
				  let dateKey1 = moment(date1).format(DATE_FORMAT);
				  
				  // For Start2
				  let date2 = new Date(data.start2);
				  let dateKey2 = moment(date2).format(DATE_FORMAT);

				  // For Start3
				  let date3 = new Date(data.start3);
				  let dateKey3 = moment(date3).format(DATE_FORMAT);

				  // For Start3
				  let date4 = new Date(data.start4);
				  let dateKey4 = moment(date4).format(DATE_FORMAT);
				  //////////////////////////////////////////////////////////////////////////////////

				  // For Start
				  if (
					moment(new Date(data.end)) > current &&
					dateKey == current.format(DATE_FORMAT)
				  ) {
					// This event is for the given day, and is either happening now, or later in the day
					todayArray.push(data);
				  } else

				  // For Start1
				  if (
					moment(new Date(data.end1)) > current &&
					dateKey1 == current.format(DATE_FORMAT) && moment(new Date(data.start1)) >= current
				  ) {
					// This event is for the given day, and is either happening now, or later in the day
					todayArray.push(data);
				  } else

				  // For Start2
				  if (
					moment(new Date(data.end2)) > current &&
					dateKey2 == current.format(DATE_FORMAT) && moment(new Date(data.start2)) >= current
				  ) {
					// This event is for the given day, and is either happening now, or later in the day
					todayArray.push(data);
				  } else

				  // For Start3
				  if (
					moment(new Date(data.end3)) > current &&
					dateKey3 == current.format(DATE_FORMAT) && moment(new Date(data.start3)) <= current
				  ) {
					// This event is for the given day, and is either happening now, or later in the day
					todayArray.push(data);
				  } else

				  // For Start4
				  if (
					moment(new Date(data.end4)) > current &&
					dateKey4 == current.format(DATE_FORMAT) && moment(new Date(data.start4)) <= current
				  ) {
					// This event is for the given day, and is either happening now, or later in the day
					todayArray.push(data);
				  }
				  //////////////////////////////////////////////////////////////////////////////////

				  // Store the first events of the day to create a summary calendar link
				  // For Start
				  if (firstEvents.has(dateKey)) {
					if (date < firstEvents[dateKey]) {
					  firstEvents.set(dateKey, date);
					}
				  } else {
					firstEvents.set(dateKey, date);
				  }

				  // For Start1
				  /* if (firstEvents.has(dateKey1)) {
					if (date1 < firstEvents[dateKey1]) {
					  firstEvents.set(dateKey1, date1);
					}
				  } else {
					firstEvents.set(dateKey1, date1);
				  } */


				}
			  });

			  

			  if (room != null) {
				var todayArrayNext = todayArray.filter(
				  (item) => item.location.toLowerCase().indexOf(room) > -1
				);
			  }

			  var todayArrayNext = room != null ? todayArrayNext : todayArray;
			  // var sortedArray  = todayArrayNext.sort((a,b) => new Date(a.start) - new Date(b.start));
			  //var sortedArray = todayArrayNext.sort(function (a, b) {
				//const aLoc = locSorting.indexOf(a.location);
				//const bLoc = locSorting.indexOf(b.location);

				//if (aLoc == -1 && bLoc == -1) {
					//return new Date(a.start) - new Date(b.start)
					/* if(b.start2 != " " || b.start2 != "") {
						return new Date(a.start) - new Date(b.start1) - new Date(b.start2) 
					} else if(b.start1 != " " || b.start1 != "") {
						return new Date(a.start) - new Date(b.start1) 
					} else { */
						//return new Date(a.start) - new Date(b.start) 
					//}
				//}
				//if (aLoc == -1) {
				  //return 1;
				//}
				//if (bLoc == -1) {
				 // return -1;
				//}
				//return new Date(a.start) - new Date(b.start);
				//return new Date(a.start) - new Date(b.start)
				/* if(b.start2 != " " || b.start2 != "") {
					return new Date(a.start) - new Date(b.start1) - new Date(b.start2) 
				} else if(b.start1 != " " || b.start1 != "") {
					return new Date(a.start) - new Date(b.start1) 
				} else { */
					//return new Date(a.start) - new Date(b.start) 
				//}
			  //});

			  ///////////////////////////////////////////////////////////////////////
			  /* function getSortedArr() {
					return [...todayArrayNext].sort(function (a, b) {
					const aLoc = locSorting.indexOf(a.location);
					const bLoc = locSorting.indexOf(b.location);
					////////////////////////////////////////////////////////
					if (aLoc == -1 && bLoc == -1) {
						if(b.start2 != '') {
							return Date.parse(a.start) - Date.parse(b.Start2)  
						} else if(b.start1 != '') {
								return Date.parse(a.start) - Date.parse(b.start1) 
						} else {
							return Date.parse(a.start) - Date.parse(b.start) 
						}
						
					}
					if (aLoc == -1) {
						return 1;
					}
					if (bLoc == -1) {
						return -1;
					}
					if(b.start2 != '') {
						return Date.parse(a.start) - Date.parse(b.Start2)  
					} else if(b.start1 != '') {
							return Date.parse(a.start) - Date.parse(b.start1) 
					} else {
						return Date.parse(a.start) - Date.parse(b.start) 
					}
					})
				}

				var sortedArray = getSortedArr() */

				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				function getSortedArr(todayArrayNext) {
					return [...todayArrayNext].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							return new Date(a.start) - new Date(b.start)
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						
						return new Date(a.start) - new Date(b.start)
					})
				}
				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				// Sort Based on Start 1
				function getSortedArrStart1(sortStart) {
					return [...sortStart].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
								return new Date(b.start) - new Date(a.start)
							} else {
								if(b.start1 != "" && new Date(b.start1) >= new Date(current) && new Date(b.start1) < nDate) {
									//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
									return new Date(a.start) - new Date(b.start1)
								} 
							}
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						/* if(b.start2 != "" && new Date(b.start2) >= new Date(selectedDate)) {
							return new Date(a.start) - new Date(b.start2)
						} */ 
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start1 != "" && new Date(b.start1) >= new Date(current) && new Date(b.start1) < nDate) {
								//console.log(new Date(b.start1) , " -1- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start1)
							} 
						}
					})
				}

				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				// Sort Based on Start 2
				function getSortedArrStart2(sortStart2) {
					return [...sortStart2].sort(function (a, b) {
						const aLoc = locSorting.indexOf(a.location);
						const bLoc = locSorting.indexOf(b.location);
						////////////////////////////////////////////////////////
						if (aLoc == -1 && bLoc == -1) {
							if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
								return new Date(b.start) - new Date(a.start)
							} else {
								if(b.start2 != "" && new Date(b.start2) >= new Date(current) && new Date(b.start2) < nDate) {
									//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
									return new Date(a.start) - new Date(b.start2)
								}
							}
						}
						if (aLoc == -1) {
							return 1;
						}
						if (bLoc == -1) {
							return -1;
						}
						/* if(b.start1 != '' && new Date(b.start1) >= new Date(selectedDate)) {
							return new Date(a.start) - new Date(b.start1)
						} */
						if(a.start != "" && new Date(b.start) >= new Date(a.start)) {
							return new Date(b.start) - new Date(a.start)
						} else {
							if(b.start2 != "" && new Date(b.start2) >= new Date(current) && new Date(b.Start2) < nDate) {
								//console.log(new Date(b.start2) , " -2- ", new Date(a.start))
								return new Date(a.start) - new Date(b.start2)
							}
						}
					})
				}

				////////////////////////////////////////////////////////////////////////////////////////////////////////////
				// Sorting Order
				////////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////////
				// Previous
				/* let sortStart = getSortedArr(todayArrayNext)
				let sortStart2 = getSortedArrStart1(sortStart)
				let sortedArray = getSortedArrStart2(sortStart2) */
				// New
				// Clear All Containers
				outputInit = [];
				output1 = [];
				output1_1 = [];
				output1_2 = [];
				output2 = [];
				output2_1 = [];
				output2_2 = [];
				output3 = [];
				// Reassing Values to those containers
				let mFormat = doFormat(todayArrayNext, nDate)
				let mFormat1 = doFormat1(mFormat, nDate)
				let mFormat2 = doFormat2(mFormat1, nDate)
				let mFormat1_1 = doFormat3(mFormat2, nDate)
				let mFormat2_1 = doFormat1_1(mFormat1_1, nDate)
				let mFormat2_2 = doFormat2_1(mFormat2_1, nDate)
				let sortedArray = doFormat2_2(mFormat2_2, nDate)
				////////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////////////////////////////////////////////

			  var slideObjArr = [];
			  var output = sortedArray.reduce(function (result, value) {
				var location = value.location;
				result[location] = result[location] || [];
				result[location].push({
				  code: value.code,
				  name: value.name,
				  speakers: value.speakers,
				  desc: value.desc,
				  start: value.start,
				  end: value.end,
				  info: value.info,
				  location: value.location,
				  capacity: value.capacity,
				  images: value.images,
				  count: value.count,
				  status: value.status,
				  link1: value.link1,
				  url1: value.url1,
				  link2: value.link2,
				  url2: value.url2,
				  platform: value.platform,
				  accessInfo: value.accessInfo,
				  start1: value.start1,
				  end1: value.end1,
				});
				return result;
			  }, {});

			  if (
				(Object.keys(output).length === 0 &&
				  output.constructor === Object) == false
			  ) {
				var counter = "";

				let entries = Object.entries(output);

				for (let [index, [key, value]] of entries.entries()) {
				  slideObjArr.push(value[0]);
				  //console.log("index:"+index  + " Key:"+ key + " value:"+ value)
				}

				//console.log(slideObjArr[slideObjArr.length-1].end);
				////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////
				sortedArray.sort()
				if(sortedArray[sortedArray.length-1].end1 != "" && sortedArray[sortedArray.length-1].end2 != "") {
					//console.log("1")
					//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End2)
					_initEventTime = sortedArray[0].start
					_lastEventTime = sortedArray[sortedArray.length-1].end2
				} else if(sortedArray[sortedArray.length-1].end1 == "" && sortedArray[sortedArray.length-1].end2 != "") {
					//console.log("2")
					//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End2)
					_initEventTime = sortedArray[0].start
					_lastEventTime = sorted1[sorted1.length-1].end2
				} else if(sortedArray[sortedArray.length-1].end1 != "" && sortedArray[sortedArray.length-1].end2 == "") {
					//console.log("3")
					//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End1) 
					_initEventTime = sortedArray[0].start
					_lastEventTime = sortedArray[sortedArray.length-1].end1
				} else {
					//console.log("4")
					//console.log(sorted1[0].Start, " ---- ", sorted1[sorted1.length-1].End) 
					_initEventTime = sortedArray[0].start
					_lastEventTime = sortedArray[sortedArray.length-1].end
				}

				//console.log(_initEventTime, " ---- ", _lastEventTime)

				////////////////////////////////////////////////////////////////////
				////////////////////////////////////////////////////////////////////

				// Storing todays event start and end of last event time
				/* todayArray.sort(todayArray.start)
				_initEventTime = todayArray[0].start
				_lastEventTime = todayArray[todayArray.length-1].end */
				////////////////////////////////////////////////////////////////////
				//console.log(_initEventTime, " IIII ", _lastEventTime)
				let randomSliderArray = slideObjArr.sort(() => Math.random() - 0.5);
				//console.log(randomSliderArray[0])
				//console.log(randomSliderArray)
				//console.log(slideObjArr)

				let shownUpnextCount = 0;
				let lastKey = "";

				$(".root").append(`${showCalLinks(todayArray.length)}`);

				// add image slider
				$(".root").append(
				  `
						<div class="mt-2 image_slider" >
						  ${randomSliderArray
							.map(function (galleryValue, index) {
							  return `
							  ${
								galleryValue.images
								  ? `
								<a class="px-2" href="#${galleryValue.location
								  .toLowerCase()
								  .replace(/\s/g, "")}">
								<div class="expect_ratio_images">
								  <img src="${
									galleryValue.images
								  }" class="ak_img_detail">
								</div>
								<div class="ak_img_desc">${galleryValue.name}
								</div>
								</a>
								`
								  : `

								`
							  }
							  `;
							})
							.join("")}
					  </div>
						`
				);

				$(".image_slider").slick({
				  dots: false,
				  arrows: true,
				  infinite: true,
				  speed: 300,
				  autoplay: true,
				  slidesToShow: 7,
				  slidesToScroll: 2,
				  responsive: [
					{
					  breakpoint: 1199,
					  settings: {
						slidesToShow: 6,
						slidesToScroll: 6,
						infinite: true,
						dots: true,
					  },
					},
					{
					  breakpoint: 999,
					  settings: {
						slidesToShow: 5,
						slidesToScroll: 5,
						infinite: true,
						dots: true,
					  },
					},
					{
					  breakpoint: 768,
					  settings: {
						slidesToShow: 3,
						slidesToScroll: 3,
					  },
					},
					{
					  breakpoint: 568,
					  settings: {
						slidesToShow: 1,
						slidesToScroll: 1,
					  },
					},
				  ]
				});
				for (let [index, [key, value]] of entries.entries()) {
				  color = colors[index % colors.length];

				  //slideObjArr.push(value[0]);
				  //console.log("index:"+index  + " Key:"+ key + " value:"+ value)
				  // console.log(
				  //  "1_index:" + index + " Key:" + key + " value:" + value[0].url1
				  // );
				  //              var path = (value[0].url1)

				  /* if (value[0].url1.length > 0) {
					if (
					  value[0].url1.indexOf("http://") === -1 ||
					  value[0].url1.indexOf("https://") === -1
					) {
					  value[0].url1 = "http://" + value[0].url1;
					}
				  }
				  */

				  

				  //if (urlString.indexOf('http://') === 0 || urlString.indexOf('https://') === 0)

				  //console.log("akhm"+(path.isAbsolute));

				  let button1 = value[0].url1
					? `
						<a href=${`${value[0].url1}`} target="_blank">
						  <button type="button" class="btn btn-outline-light float-right mt-310">${
							value[0].link1
						  }</button>
						</a>`
					: "";

				  let button2 = value[0].url2
					? `
						<a href=${`${value[0].url2}`} target="_blank">
						  <button type="button" class="btn btn-outline-light float-right mt-310">${
							value[0].link2
						  }</button>
						</a>`
					: "";

				  let platform = value[0].platform
					? `
						  <div class="tabletop-sim float-right">${value[0].platform} | ${value[0].accessInfo}</div>
						`
					: "";

				  let isHappeningNowPresent = false;
				  let shownHappeningNowCount = 0;
				  let visibleCount = 0;

				  $(".root").append(
					`
							<div class="card custom_border_left mt-2" style="border-left-color:#${color}">
							  <div class="card-header ak_card_header" style="background:#${color}">

								<h4 class="card-room d-inline" id="${key
								  .toLowerCase()
								  .replace(/\s/g, "")}">${key}</h4>

								${button2}
								${button1}

							  </div>

							  ${value
								.map(function (que, index) {
								  /* let isHappeningNow =
									current >= moment(new Date(que.start)) &&
									current < moment(new Date(que.end)); */
									let isHappeningNow = 0

									if(current < moment(new Date(que.end))) {
										isHappeningNow =
											current >= moment(new Date(que.start)) &&
											current < moment(new Date(que.end));
									} else if(current < moment(new Date(que.end1))) {
										isHappeningNow =
											current >= moment(new Date(que.start1)) &&
											current < moment(new Date(que.end1));
									} else if(current < moment(new Date(que.end2))) {
										isHappeningNow =
											current >= moment(new Date(que.start2)) &&
											current < moment(new Date(que.end2));
									} else if(current < moment(new Date(que.end3))) {
										isHappeningNow =
											current >= moment(new Date(que.start3)) &&
											current < moment(new Date(que.end3));
									} else if(current < moment(new Date(que.end4))) {
										isHappeningNow =
											current >= moment(new Date(que.start4)) &&
											current < moment(new Date(que.end4));
									}

									//////////////////////////////////////////////////////////////////
									// Find Current
									//console.log(current, " > current")
									/* if(current < moment(new Date(que.end))) {
										console.log("pick start1")
									} else {
										console.log("pick start")
									} */
									//////////////////////////////////////////////////////////////////

								  /* let isSameDay =
									current.format(DATE_FORMAT) ==
									moment(new Date(que.start)).format(DATE_FORMAT); */
									let isSameDay = 0
									if(current < moment(new Date(que.end))) {
										isSameDay =
											current.format(DATE_FORMAT) <=
											moment(new Date(que.start)).format(DATE_FORMAT);
									} else if(current < moment(new Date(que.end1))) {
										isSameDay =
											current.format(DATE_FORMAT) <=
											moment(new Date(que.start1)).format(DATE_FORMAT);
									} else if(current < moment(new Date(que.end2))) {
										isSameDay =
											current.format(DATE_FORMAT) <=
											moment(new Date(que.start2)).format(DATE_FORMAT);
									} else if(current < moment(new Date(que.end3))) {
										isSameDay =
											current.format(DATE_FORMAT) <=
											moment(new Date(que.start3)).format(DATE_FORMAT);
									} else if(current < moment(new Date(que.end4))) {
										isSameDay =
											current.format(DATE_FORMAT) <=
											moment(new Date(que.start4)).format(DATE_FORMAT);
									}


								  /* let isUpNext =
									moment(new Date(que.start)) >= current; */
									let isUpNext = 0
									if(current < moment(new Date(que.end))) {
										isUpNext =
											moment(new Date(que.start)) >= current;
									} else if(current < moment(new Date(que.end1))) {
										isUpNext =
											moment(new Date(que.start1)) >= current;
									} else if(current < moment(new Date(que.end2))) {
										isUpNext =
											moment(new Date(que.start2)) >= current;
									} else if(current < moment(new Date(que.end3))) {
										isUpNext =
											moment(new Date(que.start3)) >= current;
									} else if(current < moment(new Date(que.end4))) {
										isUpNext =
											moment(new Date(que.start4)) >= current;
									}

								  /* let isPassed =
									moment(new Date(que.end)) <= current; */
									let isPassed = 0
									if(current < moment(new Date(que.end))) {
										isPassed =
											moment(new Date(que.end)) <= current;
									} else if(current < moment(new Date(que.end1))) {
										isPassed =
											moment(new Date(que.end1)) <= current;
									} else if(current < moment(new Date(que.end2))) {
										isPassed =
											moment(new Date(que.end2)) <= current;
									} else if(current < moment(new Date(que.end3))) {
										isPassed =
											moment(new Date(que.end3)) <= current;
									} else if(current < moment(new Date(que.end4))) {
										isPassed =
											moment(new Date(que.end4)) <= current;
									}


								  let hideEvent = index > shownHappeningNowCount;
								  let showEvent =
									isHappeningNow || (isUpNext && !hideEvent);
								  if (showEvent) {
									visibleCount++;
								  }

								  if (lastKey != key) {
									shownUpnextCount = 0;
									shownHappeningNowCount = 0;
									isHappeningNowPresent = false;
								  }
								  if (!isHappeningNow && isSameDay && isUpNext) {
									shownUpnextCount += 1;
								  }
								  if (isHappeningNow && shownUpnextCount == 0) {
									isHappeningNowPresent = true;
									shownHappeningNowCount += 1;
								  }

								  lastKey = key;
								  let dispDate = ""
									if(current < moment(new Date(que.end)) && new Date(que.end) < nDate) {
										//console.log(key, " show start/end")
										dispDate = moment(new Date(que.start)).format("dddd hh:mm A") + " - " + moment(new Date(que.end)).format("hh:mm A")
									} else if(current < moment(new Date(que.end1)) && new Date(que.end1) < nDate) {
										//console.log(key, " show start1/end1")
										dispDate = moment(new Date(que.start1)).format("dddd hh:mm A") + " - " + moment(new Date(que.end1)).format("hh:mm A")
									} else if(current < moment(new Date(que.end2)) && new Date(que.end2) < nDate) {
										//console.log(key, " show start2/end2")
										dispDate = moment(new Date(que.start2)).format("dddd hh:mm A") + " - " + moment(new Date(que.end2)).format("hh:mm A")
									}
								  // console.log(que.name, {isHappeningNow: isHappeningNow, isSameDay: isSameDay, isUpNext: isUpNext, isPassed: isPassed, visibleCount: visibleCount, shownUpnextCount: shownUpnextCount, hideEvent: hideEvent, showEvent: showEvent, shownHappeningNowCount: shownHappeningNowCount, length: value.length, index: index, hasMore: hasMore});
								//console.log(isHappeningNow, " -- ", shownHappeningNowCount, " ---- ", isSameDay)
								  return `

									  ${
										shownUpnextCount == 0 &&
										isSameDay &&
										isUpNext &&
										!isHappeningNow
										  ? `<h5 class="card-title ak_card_subtitle mt-3 ml-3">NO CURRENT EVENT ${index}</h5>`
										  : ``
									  }

									  ${
										!isPassed && isSameDay
										  ? `${`
										 <div class="${
										   isHappeningNow && isSameDay
											 ? "card-body"
											 : "card-footer ak_card_footer"
										 } ${
											  hideEvent
												? `hidden_card_${key.replace(
													/\s/g,
													""
												  )}`
												: ""
											}"
										  style="${
											showEvent
											  ? "display:block"
											  : "display:none"
										  }"
										  id="
										  ${que.name
											.toLowerCase()
											.replace(/\s/g, "")}
										  "
										  >

										  ${
											isHappeningNow &&
											shownHappeningNowCount < 2 &&
											isSameDay
											  ? `<h5 class="card-title ak_card_subtitle mt-3">HAPPENING NOW</h5>`
											  : ``
										  }
										  ${
											!isHappeningNow &&
											isHappeningNowPresent &&
											isUpNext &&
											isSameDay &&
											shownUpnextCount == 1
											  ? `<h5 class="card-title ak_card_subtitle mt-3">UP NEXT</h5>`
											  : ``
										  }

										  <!--MULTIPLE////////////////////////////////////////////////////////////////////////////// -->
										  <span class="card-text ak_room_title">${
											que.code
										  } - ${que.name}</span>
										  <span>${showStatus(que)}</span>
										  <span class="float-right ak_date">${dispDate/* (current < moment(new Date(que.end))) ? moment(
											new Date(que.start)
											).format("dddd hh:mm A") : (current < moment(new Date(que.end1))) ? moment(
											new Date(que.start1)
											).format("dddd hh:mm A") : (current < moment(new Date(que.end2))) ? moment(
											new Date(que.start2)
											).format("dddd hh:mm A") : (current < moment(new Date(que.end3))) ? moment(
											new Date(que.start3)
											).format("dddd hh:mm A") : (current < moment(new Date(que.end4))) ? moment(
											new Date(que.start4)
											).format("dddd hh:mm A") : ''} - ${(current < moment(new Date(que.end))) ? moment(
												new Date(que.end)
											).format("hh:mm A") : (current < moment(new Date(que.end1))) ? moment(
												new Date(que.end1)
											).format("hh:mm A") : (current < moment(new Date(que.end2))) ? moment(
												new Date(que.end2)
											).format("hh:mm A") : (current < moment(new Date(que.end3))) ? moment(
												new Date(que.end3)
											).format("hh:mm A") : (current < moment(new Date(que.end4))) ? moment(
												new Date(que.end4)
											).format("hh:mm A") : '' */}</span>
										  <br>
										  <!--////////////////////////////////////////////////////////////////////////////// -->

										  <b style="color: black !important;">${
											que.speakers
										  }</b><br>
										  <div class="ak_room_descp mt-3">
											${
											  !que.images
												? `

											 `
												: `
											 <img class="ak_desc_img" data-toggle="modal" data-target="#${que.name
											   .toLowerCase()
											   .replace(/\s/g, "")}" src=${
													que.images
												  } />
											<div class="modal fade" id="${que.name
											  .toLowerCase()
											  .replace(
												/\s/g,
												""
											  )}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
											<div class="modal-dialog modal-xl" role="document">
											  <button type="button" class="close close-modal p-4" data-dismiss="modal" aria-label="Close">
												<span aria-hidden="true">&times;</span>
											  </button>
											  <img src=${
												que.images
											  } class="img-fluid modal-image" />
											  <span class="px-4 py-2 d-block">${
												que.name
											  }</span>
											</div>
										  </div>
											 `
											}

											<span class="d-inline-block ${
											  !que.images ? ` ` : `nay_des`
											}">${que.desc}</span>
										  </div>


										  <div class="info float-left">${
											que.info
										  }</div>
										  ${platform}
										  </div>

										  `}`
										  : ``
									  }
									  `;
								})
								.join("")}

							${
							  value.length > visibleCount
								? `<h6 class="text-center more pb-3">
							  <span class="active ${key.replace(
								/\s/g,
								""
							  )}" style="cursor:pointer">MORE</span>
							</h6>`
								: ""
							}
						`
				  );
				}
			  } else {
				$(".root").append(`${showCalLinks(todayArray.length)}`);
				$(".root").append(
				  ` <br><br><br>
					  <h1 class="text-center">NO EVENTS TODAY</h1>
		  <div class="text-center">But you can find events for the following dates:</div>
		  <div class="text-center">${showDateLinks()}</div>
					`
				);
				
			  }
			  $(".active").click(function () {
				var word = $(this).attr("class");

				var lastword = word.replace("active", "");

				var str = lastword.replace(/\s/g, "");

				if ($.trim($("." + str).text()) === "MORE") {
				  $("." + str).text("LESS");
				} else {
				  $("." + str).text("MORE");
				}
				$(`.hidden_card_${str}`).slideToggle();
			  });
			},
			error: function (params) {
			  $(".image_id").css("display", "none");

			  $(".root").append(
				`
				  <div >
					<figure>
					  <img src="http://www.earshot.chat/wp-content/uploads/2021/01/banner-1.jpg"/>
					</figure>
					<figure>
					  <img class="offline-icon" src="http://www.earshot.chat/wp-content/uploads/2021/01/earshot-logo-02.png"/>
					</figure>

					<h1 style="font-size: 19px; text-align: center; padding: 10px; margin-top: 0px;">event scheduling for classrooms, conventions, and cocktails</h1>
					<p style="text-align: center;">Copyright © 2021, Neuronic LLC.</p>
				  </div>


				`
			  );
			},
		  });
	}

    </script>
  </body>
</html>
